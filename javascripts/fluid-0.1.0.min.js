require(['bootstrap'], function () {
    window.location.rootpath = window.location.pathname;

    require(['backbone', 'marionette', 'ejs', 'controllers/fluid'], function (Backbone, Marionette, EJS, FluidController) {
        Backbone.Marionette.Renderer.render = function(template, data) {
            return template.render(data);
        };

        var FluidApp = new Marionette.Application();

        FluidApp.addRegions({
            mainRegion: "#main"
        });

        FluidApp.addInitializer(function(options){
            new FluidController({app: FluidApp}).load();
        });

        FluidApp.addInitializer(function(options){
            Backbone.history.start({pushState: true, root: window.location.rootpath});

            // Block delete button from navigating
            $(document).keydown(function (e) {
                if (e.keyCode == 8) {
                    if (
                        (document.activeElement.getAttribute('contenteditable') !== "true") &&
                            (document.activeElement.tagName !== "INPUT")
                        ) {
                        return false;
                    }
                }
                return true;
            });
        });

        FluidApp.start();
    });
});