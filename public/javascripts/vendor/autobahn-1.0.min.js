/** @license AutobahnJS - http://autobahn.ws
 *
 * Copyright 2011, 2012 Tavendo GmbH.
 * Licensed under the MIT License.
 * See license text at http://www.opensource.org/licenses/mit-license.php
 *
 * AutobahnJS includes code from:
 *
 * when - http://cujojs.com
 *
 * (c) copyright B Cavalier & J Hann
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Crypto-JS - http://code.google.com/p/crypto-js/
 *
 * (c) 2009-2012 by Jeff Mott. All rights reserved.
 * Licensed under the New BSD License at:
 * http://code.google.com/p/crypto-js/wiki/License
 *
 * console-normalizer - https://github.com/Zenovations/console-normalizer
 *
 * (c) 2012 by Zenovations.
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */

/** @license MIT License (c) copyright 2011-2013 original author or authors */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @author Brian Cavalier
 * @author John Hann
 *
 * @version 1.8.1
 */

/*
 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
 */

/** @license MIT License (c) 2011-2013 Copyright Tavendo GmbH. */

/**
 * AutobahnJS - http://autobahn.ws
 *
 * A lightweight implementation of
 *
 *   WAMP (The WebSocket Application Messaging Protocol) - http://wamp.ws
 *
 * Provides asynchronous RPC/PubSub over WebSocket.
 *
 * Copyright 2011-2013 Tavendo GmbH. Licensed under the MIT License.
 * See license text at http://www.opensource.org/licenses/mit-license.php
 */

(function(e){e||(e=window.console={log:function(e,t,n,r,i){},info:function(e,t,n,r,i){},warn:function(e,t,n,r,i){},error:function(e,t,n,r,i){}}),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,Array.prototype.concat.apply(n,arguments))}}),typeof e.log=="object"&&(e.log=Function.prototype.call.bind(e.log,e),e.info=Function.prototype.call.bind(e.info,e),e.warn=Function.prototype.call.bind(e.warn,e),e.error=Function.prototype.call.bind(e.error,e)),"group"in e||(e.group=function(t){e.info("\n--- "+t+" ---\n")}),"groupEnd"in e||(e.groupEnd=function(){e.log("\n")}),"time"in e||function(){var t={};e.time=function(e){t[e]=(new Date).getTime()},e.timeEnd=function(n){var r=(new Date).getTime(),i=n in t?r-t[n]:0;e.info(n+": "+i+"ms")}}()})(window.console),function(e){e([],function(){function r(e,t,n,r){return i(e).then(t,n,r)}function i(e){var t;return e instanceof u?t=e:c(e)?t=s(e):t=a(e),t}function s(e){var t=l();try{e.then(function(e){t.resolve(e)},function(e){t.reject(e)},function(e){t.progress(e)})}catch(n){t.reject(n)}return t.promise}function o(e){return r(e,f)}function u(e){this.then=e}function a(e){var t=new u(function(t){try{return i(typeof t=="function"?t(e):e)}catch(n){return f(n)}});return t}function f(e){var t=new u(function(t,n){try{return i(typeof n=="function"?n(e):f(e))}catch(r){return f(r)}});return t}function l(){function h(e,t,n){return o(e,t,n)}function p(e){return c(i(e))}function d(e){return c(f(e))}function v(e){return a(e)}var e,t,r,s,o,a,c;return t=new u(h),e={then:h,resolve:p,reject:d,progress:v,notify:v,promise:t,resolver:{resolve:p,reject:d,progress:v,notify:v}},r=[],s=[],o=function(e,t,n){var i,o;return i=l(),o=typeof n=="function"?function(e){try{i.notify(n(e))}catch(t){i.notify(t)}}:function(e){i.notify(e)},r.push(function(n){n.then(e,t).then(i.resolve,i.reject,o)}),s.push(o),i.promise},a=function(e){return b(s,e),e},c=function(e){return o=e.then,c=i,a=S,b(r,e),s=r=n,e},e}function c(e){return e&&typeof e.then=="function"}function h(e,t,n,i,s){return w(2,arguments),r(e,function(e){function g(e){p(e)}function y(e){h(e)}var o,u,a,f,c,h,p,d,v,m;v=e.length>>>0,o=Math.max(0,Math.min(t,v)),a=[],u=v-o+1,f=[],c=l();if(!o)c.resolve(a);else{d=c.notify,p=function(e){f.push(e),--u||(h=p=E,c.reject(f))},h=function(e){a.push(e),--o||(h=p=E,c.resolve(a))};for(m=0;m<v;++m)m in e&&r(e[m],y,g,d)}return c.promise.then(n,i,s)})}function p(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return h(e,1,i,n,r)}function d(e,t,n,r){return w(1,arguments),m(e,S).then(t,n,r)}function v(){return m(arguments,S)}function m(e,t){return r(e,function(e){var n,i,s,o,u,a;s=i=e.length>>>0,n=[],a=l();if(!s)a.resolve(n);else{o=function(i,o){r(i,t).then(function(e){n[o]=e,--s||a.resolve(n)},a.reject)};for(u=0;u<i;u++)u in e?o(e[u],u):--s}return a.promise})}function g(n,i){var s=t.call(arguments,1);return r(n,function(t){var n;return n=t.length,s[0]=function(e,t,s){return r(e,function(e){return r(t,function(t){return i(e,t,s,n)})})},e.apply(t,s)})}function y(e,t,n){var i=arguments.length>2;return r(e,function(e){return e=i?n:e,t.resolve(e),e},function(e){return t.reject(e),f(e)},function(e){return typeof t.notify=="function"&&t.notify(e),e})}function b(e,t){var n,r=0;while(n=e[r++])n(t)}function w(e,t){var n,r=t.length;while(r>e){n=t[--r];if(n!=null&&typeof n!="function")throw new Error("arg "+r+" must be a function")}}function E(){}function S(e){return e}var e,t,n;return r.defer=l,r.resolve=i,r.reject=o,r.join=v,r.all=d,r.map=m,r.reduce=g,r.any=p,r.some=h,r.chain=y,r.isPromise=c,u.prototype={always:function(e,t){return this.then(e,e,t)},otherwise:function(e){return this.then(n,e)},yield:function(e){return this.then(function(){return e})},spread:function(e){return this.then(function(t){return d(t,function(t){return e.apply(n,t)})})}},t=[].slice,e=[].reduce||function(e){var t,n,r,i,s;s=0,t=Object(this),i=t.length>>>0,n=arguments;if(n.length<=1)for(;;){if(s in t){r=t[s++];break}if(++s>=i)throw new TypeError}else r=n[1];for(;s<i;++s)s in t&&(r=e(r,t[s],s,t));return r},r})}(typeof define=="function"&&define.amd?define:function(e){typeof exports=="object"?module.exports=e():this.when=e()});var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=e.length*4},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;this.clamp();if(r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else if(n.length>65535)for(var s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){var n=[];for(var r=0;r<t;r+=4)n.push(e.random()*4294967296|0);return new s.init(n,t)}}),o=n.enc={},u=o.Hex={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((s&15).toString(16))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},a=o.Latin1={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-r%4*8;return new s.init(n,t)}},f=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,u=o*4,a=i/u;t?a=e.ceil(a):a=e.max((a|0)-this._minBufferSize,0);var f=a*o,l=e.min(f*4,i);if(f){for(var c=0;c<f;c+=o)this._doProcessBlock(r,c);var h=r.splice(0,f);n.sigBytes-=l}return new s.init(h,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),c=r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}}),h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=e.enc,i=r.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();var i=[];for(var s=0;s<n;s+=3){var o=t[s>>>2]>>>24-s%4*8&255,u=t[s+1>>>2]>>>24-(s+1)%4*8&255,a=t[s+2>>>2]>>>24-(s+2)%4*8&255,f=o<<16|u<<8|a;for(var l=0;l<4&&s+l*.75<n;l++)i.push(r.charAt(f>>>6*(3-l)&63))}var c=r.charAt(64);if(c)while(i.length%4)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=r.charAt(64);if(i){var s=e.indexOf(i);s!=-1&&(t=s)}var o=[],u=0;for(var a=0;a<t;a++)if(a%4){var f=r.indexOf(e.charAt(a-1))<<a%4*2,l=r.indexOf(e.charAt(a))>>>6-a%4*2;o[u>>>2]|=(f|l)<<24-u%4*8,u++}return n.create(o,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=e.enc,i=r.Utf8,s=e.algo,o=s.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,typeof t=="string"&&(t=i.parse(t));var n=e.blockSize,r=n*4;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();var s=this._oKey=t.clone(),o=this._iKey=t.clone(),u=s.words,a=o.words;for(var f=0;f<n;f++)u[f]^=1549556828,a[f]^=909522486;s.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var r=t.finalize(this._oKey.clone().concat(n));return r}})}(),function(e){var t=CryptoJS,n=t.lib,r=n.WordArray,i=n.Hasher,s=t.algo,o=[],u=[];(function(){function t(t){var n=e.sqrt(t);for(var r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return(e-(e|0))*4294967296|0}var r=2,i=0;while(i<64)t(r)&&(i<8&&(o[i]=n(e.pow(r,.5))),u[i]=n(e.pow(r,1/3)),i++),r++})();var a=[],f=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(o.slice(0))},_doProcessBlock:function(e,t){var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],f=n[4],l=n[5],c=n[6],h=n[7];for(var p=0;p<64;p++){if(p<16)a[p]=e[t+p]|0;else{var d=a[p-15],v=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,m=a[p-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;a[p]=v+a[p-7]+g+a[p-16]}var y=f&l^~f&c,b=r&i^r&s^i&s,w=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),E=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),S=h+E+y+u[p]+a[p],x=w+b;h=c,c=l,l=f,f=o+S|0,o=s,s=i,i=r,r=S+x|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+f|0,n[5]=n[5]+l|0,n[6]=n[6]+c|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=this._nDataBytes*8,i=t.sigBytes*8;return n[i>>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+14]=e.floor(r/4294967296),n[(i+64>>>9<<4)+15]=r,t.sigBytes=n.length*4,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(f),t.HmacSHA256=i._createHmacHelper(f)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,i=e.algo,s=i.SHA1,o=i.HMAC,u=i.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,i=o.create(n.hasher,e),s=r.create(),u=r.create([1]),a=s.words,f=u.words,l=n.keySize,c=n.iterations;while(a.length<l){var h=i.update(t).finalize(u);i.reset();var p=h.words,d=p.length,v=h;for(var m=1;m<c;m++){v=i.finalize(v),i.reset();var g=v.words;for(var y=0;y<d;y++)p[y]^=g[y]}s.concat(h),f[0]++}return s.sigBytes=l*4,s}});e.PBKDF2=function(e,t,n){return u.create(n).compute(e,t)}}();var AUTOBAHNJS_VERSION="?.?.?",AUTOBAHNJS_DEBUG=!0,ab=window.ab={};ab._version=AUTOBAHNJS_VERSION,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null)throw new TypeError;var t=new Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Infinity&&r!==-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(this===null)throw new TypeError(" this is null or not defined");var i=new Object(this),s=i.length>>>0;if({}.toString.call(e)!=="[object Function]")throw new TypeError(e+" is not a function");t&&(n=t),r=0;while(r<s){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}})}(),ab._sliceUserAgent=function(e,t,n){var r=[],i=navigator.userAgent,s=i.indexOf(e),o=i.indexOf(t,s);o<0&&(o=i.length);var u=i.slice(s,o).split(n),a=u[1].split(".");for(var f=0;f<a.length;++f)r.push(parseInt(a[f],10));return{name:u[0],version:r}},ab.getBrowser=function(){var e=navigator.userAgent;return e.indexOf("Chrome")>-1?ab._sliceUserAgent("Chrome"," ","/"):e.indexOf("Safari")>-1?ab._sliceUserAgent("Safari"," ","/"):e.indexOf("Firefox")>-1?ab._sliceUserAgent("Firefox"," ","/"):e.indexOf("MSIE")>-1?ab._sliceUserAgent("MSIE",";"," "):null},ab.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",ab.deriveKey=function(e,t){if(t&&t.salt){var n=t.salt,r=t.keylen||32,i=t.iterations||1e4,s=CryptoJS.PBKDF2(e,n,{keySize:r/4,iterations:i,hasher:CryptoJS.algo.SHA256});return s.toString(CryptoJS.enc.Base64)}return e},ab._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ab._idlen=16,ab._subprotocol="wamp",ab._newid=function(){var e="";for(var t=0;t<ab._idlen;t+=1)e+=ab._idchars.charAt(Math.floor(Math.random()*ab._idchars.length));return e},ab._newidFast=function(){return Math.random().toString(36)},ab.log=function(){if(arguments.length>1){console.group("Log Item");for(var e=0;e<arguments.length;e+=1)console.log(arguments[e]);console.groupEnd()}else console.log(arguments[0])},ab._debugrpc=!1,ab._debugpubsub=!1,ab._debugws=!1,ab.debug=function(e,t){if(!("console"in window))throw"browser does not support console object";ab._debugrpc=e,ab._debugpubsub=e,ab._debugws=t},ab.version=function(){return ab._version},ab.PrefixMap=function(){var e=this;e._index={},e._rindex={}},ab.PrefixMap.prototype.get=function(e){var t=this;return t._index[e]},ab.PrefixMap.prototype.set=function(e,t){var n=this;n._index[e]=t,n._rindex[t]=e},ab.PrefixMap.prototype.setDefault=function(e){var t=this;t._index[""]=e,t._rindex[e]=""},ab.PrefixMap.prototype.remove=function(e){var t=this,n=t._index[e];n&&(delete t._index[e],delete t._rindex[n])},ab.PrefixMap.prototype.resolve=function(e,t){var n=this,r=e.indexOf(":");if(r>=0){var i=e.substring(0,r);if(n._index[i])return n._index[i]+e.substring(r+1)}return t==1?e:null},ab.PrefixMap.prototype.shrink=function(e,t){var n=this;for(var r=e.length;r>0;r-=1){var i=e.substring(0,r),s=n._rindex[i];if(s)return s+":"+e.substring(r)}return t==1?e:null},ab._MESSAGE_TYPEID_WELCOME=0,ab._MESSAGE_TYPEID_PREFIX=1,ab._MESSAGE_TYPEID_CALL=2,ab._MESSAGE_TYPEID_CALL_RESULT=3,ab._MESSAGE_TYPEID_CALL_ERROR=4,ab._MESSAGE_TYPEID_SUBSCRIBE=5,ab._MESSAGE_TYPEID_UNSUBSCRIBE=6,ab._MESSAGE_TYPEID_PUBLISH=7,ab._MESSAGE_TYPEID_EVENT=8,ab.CONNECTION_CLOSED=0,ab.CONNECTION_LOST=1,ab.CONNECTION_RETRIES_EXCEEDED=2,ab.CONNECTION_UNREACHABLE=3,ab.CONNECTION_UNSUPPORTED=4,ab.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,ab.CONNECTION_LOST_SCHEDULED_RECONNECT=6,ab._Deferred=when.defer,ab._construct=function(e,t){return"WebSocket"in window?t?new WebSocket(e,t):new WebSocket(e):"MozWebSocket"in window?t?new MozWebSocket(e,t):new MozWebSocket(e):null},ab.Session=function(e,t,n,r){var i=this;i._wsuri=e,i._options=r,i._websocket_onopen=t,i._websocket_onclose=n,i._websocket=null,i._websocket_connected=!1,i._session_id=null,i._wamp_version=null,i._server=null,i._calls={},i._subscriptions={},i._prefixes=new ab.PrefixMap,i._txcnt=0,i._rxcnt=0,i._options&&i._options.skipSubprotocolAnnounce?i._websocket=ab._construct(i._wsuri):i._websocket=ab._construct(i._wsuri,[ab._subprotocol]);if(!i._websocket){if(n!==undefined){n(ab.CONNECTION_UNSUPPORTED);return}throw ab.browserNotSupportedMessage}i._websocket.onmessage=function(e){ab._debugws&&(i._rxcnt+=1,console.group("WS Receive"),console.info(i._wsuri+"  ["+i._session_id+"]"),console.log(i._rxcnt),console.log(e.data),console.groupEnd());var t=JSON.parse(e.data);if(t[1]in i._calls){if(t[0]===ab._MESSAGE_TYPEID_CALL_RESULT){var n=i._calls[t[1]],r=t[2];if(ab._debugrpc&&n._ab_callobj!==undefined){console.group("WAMP Call",n._ab_callobj[2]),console.timeEnd(n._ab_tid),console.group("Arguments");for(var s=3;s<n._ab_callobj.length;s+=1){var o=n._ab_callobj[s];if(o===undefined)break;console.log(o)}console.groupEnd(),console.group("Result"),console.log(r),console.groupEnd(),console.groupEnd()}n.resolve(r)}else if(t[0]===ab._MESSAGE_TYPEID_CALL_ERROR){var u=i._calls[t[1]],a=t[2],f=t[3],l=t[4];if(ab._debugrpc&&u._ab_callobj!==undefined){console.group("WAMP Call",u._ab_callobj[2]),console.timeEnd(u._ab_tid),console.group("Arguments");for(var c=3;c<u._ab_callobj.length;c+=1){var h=u._ab_callobj[c];if(h===undefined)break;console.log(h)}console.groupEnd(),console.group("Error"),console.log(a),console.log(f),l!==undefined&&console.log(l),console.groupEnd(),console.groupEnd()}l!==undefined?u.reject({uri:a,desc:f,detail:l}):u.reject({uri:a,desc:f})}delete i._calls[t[1]]}else if(t[0]===ab._MESSAGE_TYPEID_EVENT){var p=i._prefixes.resolve(t[1],!0);if(p in i._subscriptions){var d=t[1],v=t[2];ab._debugpubsub&&(console.group("WAMP Event"),console.info(i._wsuri+"  ["+i._session_id+"]"),console.log(d),console.log(v),console.groupEnd()),i._subscriptions[p].forEach(function(e){e(d,v)})}}else if(t[0]===ab._MESSAGE_TYPEID_WELCOME){if(i._session_id!==null)throw"protocol error (welcome message received more than once)";i._session_id=t[1],i._wamp_version=t[2],i._server=t[3];if(ab._debugrpc||ab._debugpubsub)console.group("WAMP Welcome"),console.info(i._wsuri+"  ["+i._session_id+"]"),console.log(i._wamp_version),console.log(i._server),console.groupEnd();i._websocket_onopen!==null&&i._websocket_onopen()}},i._websocket.onopen=function(e){if(i._websocket.protocol!==ab._subprotocol)if(typeof i._websocket.protocol=="undefined")ab._debugws&&(console.group("WS Warning"),console.info(i._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else{if(!i._options||!i._options.skipSubprotocolCheck)throw i._websocket.close(1e3,"server does not speak WAMP"),"server does not speak WAMP (but '"+i._websocket.protocol+"' !)";ab._debugws&&(console.group("WS Warning"),console.info(i._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(i._websocket.protocol),console.groupEnd())}ab._debugws&&(console.group("WAMP Connect"),console.info(i._wsuri),console.log(i._websocket.protocol),console.groupEnd()),i._websocket_connected=!0},i._websocket.onerror=function(e){},i._websocket.onclose=function(e){ab._debugws&&(i._websocket_connected?console.log("Autobahn connection to "+i._wsuri+" lost (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+")."):console.log("Autobahn could not connect to "+i._wsuri+" (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+").")),i._websocket_onclose!==undefined&&(i._websocket_connected?e.wasClean?i._websocket_onclose(ab.CONNECTION_CLOSED,"WS-"+e.code+": "+e.reason):i._websocket_onclose(ab.CONNECTION_LOST):i._websocket_onclose(ab.CONNECTION_UNREACHABLE)),i._websocket_connected=!1,i._wsuri=null,i._websocket_onopen=null,i._websocket_onclose=null,i._websocket=null}},ab.Session.prototype._send=function(e){var t=this;if(!t._websocket_connected)throw"Autobahn not connected";var n;switch(!0){case window.Prototype&&typeof top.window.__prototype_deleted=="undefined":case typeof e.toJSON=="function":n=e.toJSON();break;default:n=JSON.stringify(e)}t._websocket.send(n),t._txcnt+=1,ab._debugws&&(console.group("WS Send"),console.info(t._wsuri+"  ["+t._session_id+"]"),console.log(t._txcnt),console.log(n),console.groupEnd())},ab.Session.prototype.close=function(){var e=this;e._websocket_connected&&e._websocket.close()},ab.Session.prototype.sessionid=function(){var e=this;return e._session_id},ab.Session.prototype.shrink=function(e,t){var n=this;return t===undefined&&(t=!0),n._prefixes.shrink(e,t)},ab.Session.prototype.resolve=function(e,t){var n=this;return t===undefined&&(t=!0),n._prefixes.resolve(e,t)},ab.Session.prototype.prefix=function(e,t){var n=this;n._prefixes.set(e,t);if(ab._debugrpc||ab._debugpubsub)console.group("WAMP Prefix"),console.info(n._wsuri+"  ["+n._session_id+"]"),console.log(e),console.log(t),console.groupEnd();var r=[ab._MESSAGE_TYPEID_PREFIX,e,t];n._send(r)},ab.Session.prototype.call=function(){var e=this,t=new ab._Deferred,n;for(;;){n=ab._newidFast();if(!(n in e._calls))break}e._calls[n]=t;var r=e._prefixes.shrink(arguments[0],!0),i=[ab._MESSAGE_TYPEID_CALL,n,r];for(var s=1;s<arguments.length;s+=1)i.push(arguments[s]);return e._send(i),ab._debugrpc&&(t._ab_callobj=i,t._ab_tid=e._wsuri+"  ["+e._session_id+"]["+n+"]",console.time(t._ab_tid),console.info()),t},ab.Session.prototype.subscribe=function(e,t){var n=this,r=n._prefixes.resolve(e,!0);if(!(r in n._subscriptions)){ab._debugpubsub&&(console.group("WAMP Subscribe"),console.info(n._wsuri+"  ["+n._session_id+"]"),console.log(e),console.log(t),console.groupEnd());var i=[ab._MESSAGE_TYPEID_SUBSCRIBE,e];n._send(i),n._subscriptions[r]=[]}var s=n._subscriptions[r].indexOf(t);if(s!==-1)throw"callback "+t+" already subscribed for topic "+r;n._subscriptions[r].push(t)},ab.Session.prototype.unsubscribe=function(e,t){var n=this,r=n._prefixes.resolve(e,!0);if(!(r in n._subscriptions))throw"not subscribed to topic "+r;var i;if(t!==undefined){var s=n._subscriptions[r].indexOf(t);if(s===-1)throw"no callback "+t+" subscribed on topic "+r;i=t,n._subscriptions[r].splice(s,1)}else i=n._subscriptions[r].slice(),n._subscriptions[r]=[];if(n._subscriptions[r].length===0){delete n._subscriptions[r],ab._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(n._wsuri+"  ["+n._session_id+"]"),console.log(e),console.log(i),console.groupEnd());var o=[ab._MESSAGE_TYPEID_UNSUBSCRIBE,e];n._send(o)}},ab.Session.prototype.publish=function(){var e=this,t=arguments[0],n=arguments[1],r=null,i=null,s=null,o=null;if(arguments.length>3){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";i=arguments[2],s=arguments[3],o=[ab._MESSAGE_TYPEID_PUBLISH,t,n,i,s]}else if(arguments.length>2)if(typeof arguments[2]=="boolean")r=arguments[2],o=[ab._MESSAGE_TYPEID_PUBLISH,t,n,r];else{if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";i=arguments[2],o=[ab._MESSAGE_TYPEID_PUBLISH,t,n,i]}else o=[ab._MESSAGE_TYPEID_PUBLISH,t,n];ab._debugpubsub&&(console.group("WAMP Publish"),console.info(e._wsuri+"  ["+e._session_id+"]"),console.log(t),console.log(n),r!==null?console.log(r):i!==null&&(console.log(i),s!==null&&console.log(s)),console.groupEnd()),e._send(o)},ab.Session.prototype.authreq=function(e,t){return this.call("http://api.wamp.ws/procedure#authreq",e,t)},ab.Session.prototype.authsign=function(e,t){return t||(t=""),CryptoJS.HmacSHA256(e,t).toString(CryptoJS.enc.Base64)},ab.Session.prototype.auth=function(e){return this.call("http://api.wamp.ws/procedure#auth",e)},ab._connect=function(e){var t=new ab.Session(e.wsuri,function(){e.connects+=1,e.retryCount=0,e.onConnect(t)},function(t,n){switch(t){case ab.CONNECTION_CLOSED:e.onHangup(t,"Connection was closed properly ["+n+"]");break;case ab.CONNECTION_UNSUPPORTED:e.onHangup(t,"Browser does not support WebSocket.");break;case ab.CONNECTION_UNREACHABLE:e.retryCount+=1;if(e.connects==0)e.onHangup(t,"Connection could not be established.");else if(e.retryCount<=e.options.maxRetries){var r=e.onHangup(ab.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+e.options.retryDelay/1e3+" second(s).",{delay:e.options.retryDelay,retries:e.retryCount,maxretries:e.options.maxRetries});r?(console.log("Connection unreachable - retrying stopped by app"),e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(console.log("Connection unreachable - retrying ("+e.retryCount+") .."),window.setTimeout(ab._connect,e.options.retryDelay,e))}else e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case ab.CONNECTION_LOST:e.retryCount+=1;if(e.retryCount<=e.options.maxRetries){var r=e.onHangup(ab.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled reconnect to occur in "+e.options.retryDelay/1e3+" second(s).",{delay:e.options.retryDelay,retries:e.retryCount,maxretries:e.options.maxRetries});r?(console.log("Connection lost - retrying stopped by app"),e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):(console.log("Connection lost - retrying ("+e.retryCount+") .."),window.setTimeout(ab._connect,e.options.retryDelay,e))}else e.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect"}},e.options)},ab.connect=function(e,t,n,r){var i={};i.wsuri=e,r?i.options=r:i.options={},i.options.retryDelay==undefined&&(i.options.retryDelay=5e3),i.options.maxRetries==undefined&&(i.options.maxRetries=10),i.options.skipSubprotocolCheck==undefined&&(i.options.skipSubprotocolCheck=!1),i.options.skipSubprotocolAnnounce==undefined&&(i.options.skipSubprotocolAnnounce=!1);if(!t)throw"onConnect handler required!";i.onConnect=t,n?i.onHangup=n:i.onHangup=function(e,t,n){console.log(e,t,n)},i.connects=0,i.retryCount=0,ab._connect(i)},ab._UA_FIREFOX=new RegExp(".*Firefox/([0-9+]*).*"),ab._UA_CHROME=new RegExp(".*Chrome/([0-9+]*).*"),ab._UA_CHROMEFRAME=new RegExp(".*chromeframe/([0-9]*).*"),ab._UA_WEBKIT=new RegExp(".*AppleWebKit/([0-9+.]*)w*.*"),ab._UA_WEBOS=new RegExp(".*webOS/([0-9+.]*)w*.*"),ab._matchRegex=function(e,t){var n=t.exec(e);return n?n[1]:n},ab.lookupWsSupport=function(){var e=navigator.userAgent;if(e.indexOf("MSIE")>-1){if(e.indexOf("MSIE 10")>-1)return[!0,!0,!0];if(e.indexOf("chromeframe")>-1){var t=parseInt(ab._matchRegex(e,ab._UA_CHROMEFRAME));return t>=14?[!0,!1,!0]:[!1,!1,!1]}return e.indexOf("MSIE 8")>-1||e.indexOf("MSIE 9")>-1?[!0,!0,!0]:[!1,!1,!1]}if(e.indexOf("Firefox")>-1){var t=parseInt(ab._matchRegex(e,ab._UA_FIREFOX));return t?t>=7?[!0,!1,!0]:t>=3?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!0]}if(e.indexOf("Safari")>-1&&e.indexOf("Chrome")==-1){var t=ab._matchRegex(e,ab._UA_WEBKIT);if(t){if(e.indexOf("Windows")>-1&&t=="534+")return[!0,!1,!0];if(e.indexOf("Macintosh")>-1){t=t.replace("+","").split(".");if(parseInt(t[0])==535&&parseInt(t[1])>=24||parseInt(t[0])>535)return[!0,!1,!0]}return e.indexOf("webOS")>-1?(t=ab._matchRegex(e,ab._UA_WEBOS).split("."),parseInt(t[0])==2?[!1,!0,!0]:[!1,!1,!1]):[!0,!0,!0]}return[!1,!1,!1]}if(e.indexOf("Chrome")>-1){var t=parseInt(ab._matchRegex(e,ab._UA_CHROME));return t?t>=14?[!0,!1,!0]:t>=4?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!1]}if(e.indexOf("Android")>-1)return e.indexOf("Firefox")>-1?[!0,!1,!0]:e.indexOf("CrMo")>-1?[!0,!1,!0]:e.indexOf("Opera")>-1?[!1,!1,!0]:e.indexOf("CrMo")>-1?[!0,!0,!0]:[!1,!1,!1];return e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1?[!1,!1,!0]:[!1,!1,!1]};