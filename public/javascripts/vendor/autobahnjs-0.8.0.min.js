/** @license AutobahnJS - http://autobahn.ws
 *
 * Copyright 2011, 2012 Tavendo GmbH.
 * Licensed under the MIT License.
 * See license text at http://www.opensource.org/licenses/mit-license.php
 *
 * AutobahnJS includes code from:
 *
 * when - http://cujojs.com
 *
 * (c) copyright B Cavalier & J Hann
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Crypto-JS - http://code.google.com/p/crypto-js/
 *
 * (c) 2009-2012 by Jeff Mott. All rights reserved.
 * Licensed under the New BSD License at:
 * http://code.google.com/p/crypto-js/wiki/License
 *
 * console-normalizer - https://github.com/Zenovations/console-normalizer
 *
 * (c) 2012 by Zenovations.
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 */

/** @license MIT License (c) copyright 2011-2013 original author or authors */

/**
 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @author Brian Cavalier
 * @author John Hann
 * @version 2.5.1
 */

/*
 CryptoJS v3.1.2
 code.google.com/p/crypto-js
 (c) 2009-2013 by Jeff Mott. All rights reserved.
 code.google.com/p/crypto-js/wiki/License
 */

/** @license MIT License (c) 2011-2013 Copyright Tavendo GmbH. */

/**
 * AutobahnJS - http://autobahn.ws
 *
 * A lightweight implementation of
 *
 *   WAMP (The WebSocket Application Messaging Protocol) - http://wamp.ws
 *
 * Provides asynchronous RPC/PubSub over WebSocket.
 *
 * Copyright 2011-2013 Tavendo GmbH. Licensed under the MIT License.
 * See license text at http://www.opensource.org/licenses/mit-license.php
 */

window.define||(window.define=function(e){try{delete window.define}catch(t){window.define=void 0}window.when=e()},window.define.amd={}),function(e){e||(e=window.console={log:function(e,t,n,r,i){},info:function(e,t,n,r,i){},warn:function(e,t,n,r,i){},error:function(e,t,n,r,i){}}),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,Array.prototype.concat.apply(n,arguments))}}),typeof e.log=="object"&&(e.log=Function.prototype.call.bind(e.log,e),e.info=Function.prototype.call.bind(e.info,e),e.warn=Function.prototype.call.bind(e.warn,e),e.error=Function.prototype.call.bind(e.error,e)),"group"in e||(e.group=function(t){e.info("\n--- "+t+" ---\n")}),"groupEnd"in e||(e.groupEnd=function(){e.log("\n")}),"time"in e||function(){var t={};e.time=function(e){t[e]=(new Date).getTime()},e.timeEnd=function(n){var r=(new Date).getTime(),i=n in t?r-t[n]:0;e.info(n+": "+i+"ms")}}()}(window.console),function(e,t){e(function(e){function n(e,t,n,i){return r(e).then(t,n,i)}function r(e){return e instanceof i?e:s(e)}function i(e,t){this._message=e,this.inspect=t}function s(e){return a(function(t){t(e)})}function o(e){return n(e,h)}function u(){function r(r,i,o){e.resolve=e.resolver.resolve=function(e){return n?s(e):(n=!0,r(e),t)},e.reject=e.resolver.reject=function(e){return n?s(h(e)):(n=!0,i(e),t)},e.notify=e.resolver.notify=function(e){return o(e),e}}var e,t,n;return e={promise:W,resolve:W,reject:W,notify:W,resolver:{resolve:W,reject:W,notify:W}},e.promise=t=a(r),e}function a(e){return f(e,R.PromiseStatus&&R.PromiseStatus())}function f(e,t){function u(e,t,n,i){function o(r){r._message(e,t,n,i)}s?s.push(o):X(function(){o(r)})}function a(){return r?r.inspect():M()}function f(e){if(!s)return;var i=s;s=W,X(function(){r=v(n,e),t&&b(r,t),l(i,r)})}function c(e){f(h(e))}function p(e){if(s){var t=s;X(function(){l(t,d(e))})}}var n,r,s=[];n=new i(u,a),n._status=t;try{e(f,c,p)}catch(o){c(o)}return n}function l(e,t){for(var n=0;n<e.length;n++)e[n](t)}function c(e){return p(new g(e),function(){return A(e)})}function h(e){return p(new y(e),function(){return O(e)})}function p(e,t){return new i(function(t,n,r){try{r(e[t].apply(e,n))}catch(i){r(h(i))}},t)}function d(e){return new i(function(t,n,r,i){var s=n[2];try{i(typeof s=="function"?s(e):e)}catch(o){i(o)}})}function v(e,t){if(t===e)return h(new TypeError);if(t instanceof i)return t;try{var n=t===Object(t)&&t.then;return typeof n=="function"?m(n,t):c(t)}catch(r){return h(r)}}function m(e,t){return a(function(n,r){P(e,t,n,r)})}function g(e){this.value=e}function y(e){this.reason=e}function b(e,t){function n(){t.fulfilled()}function r(e){t.rejected(e)}e.then(n,r)}function w(e){return e&&typeof e.then=="function"}function E(e,t,r,i,s){return n(e,function(e){function o(r,i,s){function d(e){c(e)}function v(e){l(e)}var o,u,a,f,l,c,h,p;h=e.length>>>0,o=Math.max(0,Math.min(t,h)),a=[],u=h-o+1,f=[];if(!o)r(a);else{c=function(e){f.push(e),--u||(l=c=J,i(f))},l=function(e){a.push(e),--o||(l=c=J,r(a))};for(p=0;p<h;++p)p in e&&n(e[p],v,d,s)}}return a(o).then(r,i,s)})}function S(e,t,n,r){function i(e){return t?t(e[0]):e[0]}return E(e,1,i,n,r)}function x(e,t,n,r){return k(e,J).then(t,n,r)}function T(){return k(arguments,J)}function N(e){return k(e,A,O)}function C(e,t){return k(e,t)}function k(e,t,r){return n(e,function(e){function i(i,s,o){function c(e,a){n(e,t,r).then(function(e){u[a]=e,--f||i(u)},s,o)}var u,a,f,l;f=a=e.length>>>0,u=[];if(!f){i(u);return}for(l=0;l<a;l++)l in e?c(e[l],l):--f}return f(i)})}function L(e,t){var r=P(D,arguments,1);return n(e,function(e){var i;return i=e.length,r[0]=function(e,r,s){return n(e,function(e){return n(r,function(n){return t(e,n,s,i)})})},_.apply(e,r)})}function A(e){return{state:"fulfilled",value:e}}function O(e){return{state:"rejected",reason:e}}function M(){return{state:"pending"}}function X(e){B.push(e)===1&&H(V)}function V(){l(B),B=[]}function J(e){return e}n.promise=a,n.resolve=s,n.reject=o,n.defer=u,n.join=T,n.all=x,n.map=C,n.reduce=L,n.settle=N,n.any=S,n.some=E,n.isPromise=w,n.isPromiseLike=w,i.prototype={then:function(e,t,n){var r,i;return r=arguments,i=this._message,f(function(e,t,n){i("when",r,e,n)},this._status&&this._status.observed())},otherwise:function(e){return this.then(W,e)},ensure:function(e){function t(){return s(e())}return typeof e=="function"?this.then(t,t).yield(this):this},yield:function(e){return this.then(function(){return e})},tap:function(e){return this.then(e).yield(this)},spread:function(e){return this.then(function(t){return x(t,function(t){return e.apply(W,t)})})},always:function(e,t){return this.then(e,e,t)}},g.prototype.when=function(e){return typeof e=="function"?e(this.value):this.value},y.prototype.when=function(e,t){if(typeof t=="function")return t(this.reason);throw this.reason};var _,D,P,H,B,j,F,I,q,R,U,z,W;U=e,B=[],j=t.setTimeout,R=typeof console!="undefined"?console:n;if(typeof process=="object"&&process.nextTick)H=process.nextTick;else if(z=t.MutationObserver||t.WebKitMutationObserver)H=function(e,t,n){var r=e.createElement("div");return(new t(n)).observe(r,{attributes:!0}),function(){r.setAttribute("x","x")}}(document,z,V);else try{H=U("vertx").runOnLoop||U("vertx").runOnContext}catch($){H=function(e){j(e,0)}}return F=Function.prototype,I=F.call,P=F.bind?I.bind(I):function(e,t){return e.apply(t,D.call(arguments,2))},q=[],D=q.slice,_=q.reduce||function(e){var t,n,r,i,s;s=0,t=Object(this),i=t.length>>>0,n=arguments;if(n.length<=1)for(;;){if(s in t){r=t[s++];break}if(++s>=i)throw new TypeError}else r=n[1];for(;s<i;++s)s in t&&(r=e(r,t[s],s,t));return r},n})}(typeof define=="function"&&define.amd?define:function(e){module.exports=e(require)},this);var CryptoJS=CryptoJS||function(e,t){var n={},r=n.lib={},i=r.Base=function(){function e(){}return{extend:function(t){e.prototype=this;var n=new e;return t&&n.mixIn(t),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),s=r.WordArray=i.extend({init:function(e,n){e=this.words=e||[],n!=t?this.sigBytes=n:this.sigBytes=e.length*4},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;this.clamp();if(r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else if(n.length>65535)for(var s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];else t.push.apply(t,n);return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){var n=[];for(var r=0;r<t;r+=4)n.push(e.random()*4294967296|0);return new s.init(n,t)}}),o=n.enc={},u=o.Hex={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((s&15).toString(16))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(n,t/2)}},a=o.Latin1={stringify:function(e){var t=e.words,n=e.sigBytes,r=[];for(var i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){var t=e.length,n=[];for(var r=0;r<t;r++)n[r>>>2]|=(e.charCodeAt(r)&255)<<24-r%4*8;return new s.init(n,t)}},f=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){typeof e=="string"&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,o=this.blockSize,u=o*4,a=i/u;t?a=e.ceil(a):a=e.max((a|0)-this._minBufferSize,0);var f=a*o,l=e.min(f*4,i);if(f){for(var c=0;c<f;c+=o)this._doProcessBlock(r,c);var h=r.splice(0,f);n.sigBytes-=l}return new s.init(h,l)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),c=r.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,n){return(new e.init(n)).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return(new h.HMAC.init(e,n)).finalize(t)}}}),h=n.algo={};return n}(Math);(function(){var e=CryptoJS,t=e.lib,n=t.WordArray,r=e.enc,i=r.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();var i=[];for(var s=0;s<n;s+=3){var o=t[s>>>2]>>>24-s%4*8&255,u=t[s+1>>>2]>>>24-(s+1)%4*8&255,a=t[s+2>>>2]>>>24-(s+2)%4*8&255,f=o<<16|u<<8|a;for(var l=0;l<4&&s+l*.75<n;l++)i.push(r.charAt(f>>>6*(3-l)&63))}var c=r.charAt(64);if(c)while(i.length%4)i.push(c);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=r.charAt(64);if(i){var s=e.indexOf(i);s!=-1&&(t=s)}var o=[],u=0;for(var a=0;a<t;a++)if(a%4){var f=r.indexOf(e.charAt(a-1))<<a%4*2,l=r.indexOf(e.charAt(a))>>>6-a%4*2;o[u>>>2]|=(f|l)<<24-u%4*8,u++}return n.create(o,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=e.enc,i=r.Utf8,s=e.algo,o=s.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,typeof t=="string"&&(t=i.parse(t));var n=e.blockSize,r=n*4;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();var s=this._oKey=t.clone(),o=this._iKey=t.clone(),u=s.words,a=o.words;for(var f=0;f<n;f++)u[f]^=1549556828,a[f]^=909522486;s.sigBytes=o.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);t.reset();var r=t.finalize(this._oKey.clone().concat(n));return r}})}(),function(e){var t=CryptoJS,n=t.lib,r=n.WordArray,i=n.Hasher,s=t.algo,o=[],u=[];(function(){function t(t){var n=e.sqrt(t);for(var r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return(e-(e|0))*4294967296|0}var r=2,i=0;while(i<64)t(r)&&(i<8&&(o[i]=n(e.pow(r,.5))),u[i]=n(e.pow(r,1/3)),i++),r++})();var a=[],f=s.SHA256=i.extend({_doReset:function(){this._hash=new r.init(o.slice(0))},_doProcessBlock:function(e,t){var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],f=n[4],l=n[5],c=n[6],h=n[7];for(var p=0;p<64;p++){if(p<16)a[p]=e[t+p]|0;else{var d=a[p-15],v=(d<<25|d>>>7)^(d<<14|d>>>18)^d>>>3,m=a[p-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;a[p]=v+a[p-7]+g+a[p-16]}var y=f&l^~f&c,b=r&i^r&s^i&s,w=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),E=(f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25),S=h+E+y+u[p]+a[p],x=w+b;h=c,c=l,l=f,f=o+S|0,o=s,s=i,i=r,r=S+x|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+f|0,n[5]=n[5]+l|0,n[6]=n[6]+c|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=this._nDataBytes*8,i=t.sigBytes*8;return n[i>>>5]|=128<<24-i%32,n[(i+64>>>9<<4)+14]=e.floor(r/4294967296),n[(i+64>>>9<<4)+15]=r,t.sigBytes=n.length*4,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(f),t.HmacSHA256=i._createHmacHelper(f)}(Math),function(){var e=CryptoJS,t=e.lib,n=t.Base,r=t.WordArray,i=e.algo,s=i.SHA1,o=i.HMAC,u=i.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,i=o.create(n.hasher,e),s=r.create(),u=r.create([1]),a=s.words,f=u.words,l=n.keySize,c=n.iterations;while(a.length<l){var h=i.update(t).finalize(u);i.reset();var p=h.words,d=p.length,v=h;for(var m=1;m<c;m++){v=i.finalize(v),i.reset();var g=v.words;for(var y=0;y<d;y++)p[y]^=g[y]}s.concat(h),f[0]++}return s.sigBytes=l*4,s}});e.PBKDF2=function(e,t,n){return u.create(n).compute(e,t)}}();var AUTOBAHNJS_VERSION="?.?.?";(function(e,t){typeof define=="function"&&define.amd?define(["when"],function(n){return e.ab=t(n)}):typeof exports!="undefined"?typeof module!="undefined"&&module.exports&&(exports=module.exports=t(e.when)):e.ab=t(e.when)})(this,function(e){var t={};return t._version=AUTOBAHNJS_VERSION,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null)throw new TypeError;var t=new Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Infinity&&r!==-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(this===null)throw new TypeError(" this is null or not defined");var i=new Object(this),s=i.length>>>0;if({}.toString.call(e)!=="[object Function]")throw new TypeError(e+" is not a function");t&&(n=t),r=0;while(r<s){var o;r in i&&(o=i[r],e.call(n,o,r,i)),r++}})}(),t._sliceUserAgent=function(e,t,n){var r=[],i=navigator.userAgent,s=i.indexOf(e),o=i.indexOf(t,s);o<0&&(o=i.length);var u=i.slice(s,o).split(n),a=u[1].split(".");for(var f=0;f<a.length;++f)r.push(parseInt(a[f],10));return{name:u[0],version:r}},t.getBrowser=function(){var e=navigator.userAgent;return e.indexOf("Chrome")>-1?t._sliceUserAgent("Chrome"," ","/"):e.indexOf("Safari")>-1?t._sliceUserAgent("Safari"," ","/"):e.indexOf("Firefox")>-1?t._sliceUserAgent("Firefox"," ","/"):e.indexOf("MSIE")>-1?t._sliceUserAgent("MSIE",";"," "):null},t.getServerUrl=function(e,t){if(window.location.protocol==="file:")return t?t:"ws://127.0.0.1/ws";var n=window.location.protocol==="https:"?"wss://":"ws://",r=window.location.port!==""?":"+window.location.port:"",i=e?e:"ws";return n+window.location.hostname+r+"/"+i},t.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",t.deriveKey=function(e,t){if(t&&t.salt){var n=t.salt,r=t.keylen||32,i=t.iterations||1e4,s=CryptoJS.PBKDF2(e,n,{keySize:r/4,iterations:i,hasher:CryptoJS.algo.SHA256});return s.toString(CryptoJS.enc.Base64)}return e},t._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t._idlen=16,t._subprotocol="wamp",t._newid=function(){var e="";for(var n=0;n<t._idlen;n+=1)e+=t._idchars.charAt(Math.floor(Math.random()*t._idchars.length));return e},t._newidFast=function(){return Math.random().toString(36)},t.log=function(){if(arguments.length>1){console.group("Log Item");for(var e=0;e<arguments.length;e+=1)console.log(arguments[e]);console.groupEnd()}else console.log(arguments[0])},t._debugrpc=!1,t._debugpubsub=!1,t._debugws=!1,t._debugconnect=!1,t.debug=function(e,n,r){if(!("console"in window))throw"browser does not support console object";t._debugrpc=e,t._debugpubsub=e,t._debugws=n,t._debugconnect=r},t.version=function(){return t._version},t.PrefixMap=function(){var e=this;e._index={},e._rindex={}},t.PrefixMap.prototype.get=function(e){var t=this;return t._index[e]},t.PrefixMap.prototype.set=function(e,t){var n=this;n._index[e]=t,n._rindex[t]=e},t.PrefixMap.prototype.setDefault=function(e){var t=this;t._index[""]=e,t._rindex[e]=""},t.PrefixMap.prototype.remove=function(e){var t=this,n=t._index[e];n&&(delete t._index[e],delete t._rindex[n])},t.PrefixMap.prototype.resolve=function(e,t){var n=this,r=e.indexOf(":");if(r>=0){var i=e.substring(0,r);if(n._index[i])return n._index[i]+e.substring(r+1)}return t===!0?e:null},t.PrefixMap.prototype.shrink=function(e,t){var n=this;for(var r=e.length;r>0;r-=1){var i=e.substring(0,r),s=n._rindex[i];if(s)return s+":"+e.substring(r)}return t===!0?e:null},t._MESSAGE_TYPEID_WELCOME=0,t._MESSAGE_TYPEID_PREFIX=1,t._MESSAGE_TYPEID_CALL=2,t._MESSAGE_TYPEID_CALL_RESULT=3,t._MESSAGE_TYPEID_CALL_ERROR=4,t._MESSAGE_TYPEID_SUBSCRIBE=5,t._MESSAGE_TYPEID_UNSUBSCRIBE=6,t._MESSAGE_TYPEID_PUBLISH=7,t._MESSAGE_TYPEID_EVENT=8,t.CONNECTION_CLOSED=0,t.CONNECTION_LOST=1,t.CONNECTION_RETRIES_EXCEEDED=2,t.CONNECTION_UNREACHABLE=3,t.CONNECTION_UNSUPPORTED=4,t.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,t.CONNECTION_LOST_SCHEDULED_RECONNECT=6,t.Deferred=e.defer,t._construct=function(e,t){return"WebSocket"in window?t?new WebSocket(e,t):new WebSocket(e):"MozWebSocket"in window?t?new MozWebSocket(e,t):new MozWebSocket(e):null},t.Session=function(e,n,r,i){var s=this;s._wsuri=e,s._options=i,s._websocket_onopen=n,s._websocket_onclose=r,s._websocket=null,s._websocket_connected=!1,s._session_id=null,s._wamp_version=null,s._server=null,s._calls={},s._subscriptions={},s._prefixes=new t.PrefixMap,s._txcnt=0,s._rxcnt=0,s._options&&s._options.skipSubprotocolAnnounce?s._websocket=t._construct(s._wsuri):s._websocket=t._construct(s._wsuri,[t._subprotocol]);if(!s._websocket){if(r!==undefined){r(t.CONNECTION_UNSUPPORTED);return}throw t.browserNotSupportedMessage}s._websocket.onmessage=function(e){t._debugws&&(s._rxcnt+=1,console.group("WS Receive"),console.info(s._wsuri+"  ["+s._session_id+"]"),console.log(s._rxcnt),console.log(e.data),console.groupEnd());var n=JSON.parse(e.data);if(n[1]in s._calls){if(n[0]===t._MESSAGE_TYPEID_CALL_RESULT){var r=s._calls[n[1]],i=n[2];if(t._debugrpc&&r._ab_callobj!==undefined){console.group("WAMP Call",r._ab_callobj[2]),console.timeEnd(r._ab_tid),console.group("Arguments");for(var o=3;o<r._ab_callobj.length;o+=1){var u=r._ab_callobj[o];if(u===undefined)break;console.log(u)}console.groupEnd(),console.group("Result"),console.log(i),console.groupEnd(),console.groupEnd()}r.resolve(i)}else if(n[0]===t._MESSAGE_TYPEID_CALL_ERROR){var a=s._calls[n[1]],f=n[2],l=n[3],c=n[4];if(t._debugrpc&&a._ab_callobj!==undefined){console.group("WAMP Call",a._ab_callobj[2]),console.timeEnd(a._ab_tid),console.group("Arguments");for(var h=3;h<a._ab_callobj.length;h+=1){var p=a._ab_callobj[h];if(p===undefined)break;console.log(p)}console.groupEnd(),console.group("Error"),console.log(f),console.log(l),c!==undefined&&console.log(c),console.groupEnd(),console.groupEnd()}c!==undefined?a.reject({uri:f,desc:l,detail:c}):a.reject({uri:f,desc:l})}delete s._calls[n[1]]}else if(n[0]===t._MESSAGE_TYPEID_EVENT){var d=s._prefixes.resolve(n[1],!0);if(d in s._subscriptions){var v=n[1],m=n[2];t._debugpubsub&&(console.group("WAMP Event"),console.info(s._wsuri+"  ["+s._session_id+"]"),console.log(v),console.log(m),console.groupEnd()),s._subscriptions[d].forEach(function(e){e(v,m)})}}else if(n[0]===t._MESSAGE_TYPEID_WELCOME){if(s._session_id!==null)throw"protocol error (welcome message received more than once)";s._session_id=n[1],s._wamp_version=n[2],s._server=n[3];if(t._debugrpc||t._debugpubsub)console.group("WAMP Welcome"),console.info(s._wsuri+"  ["+s._session_id+"]"),console.log(s._wamp_version),console.log(s._server),console.groupEnd();s._websocket_onopen!==null&&s._websocket_onopen()}},s._websocket.onopen=function(e){if(s._websocket.protocol!==t._subprotocol)if(typeof s._websocket.protocol=="undefined")t._debugws&&(console.group("WS Warning"),console.info(s._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else{if(!s._options||!s._options.skipSubprotocolCheck)throw s._websocket.close(1e3,"server does not speak WAMP"),"server does not speak WAMP (but '"+s._websocket.protocol+"' !)";t._debugws&&(console.group("WS Warning"),console.info(s._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(s._websocket.protocol),console.groupEnd())}t._debugws&&(console.group("WAMP Connect"),console.info(s._wsuri),console.log(s._websocket.protocol),console.groupEnd()),s._websocket_connected=!0},s._websocket.onerror=function(e){},s._websocket.onclose=function(e){t._debugws&&(s._websocket_connected?console.log("Autobahn connection to "+s._wsuri+" lost (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+")."):console.log("Autobahn could not connect to "+s._wsuri+" (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+").")),s._websocket_onclose!==undefined&&(s._websocket_connected?e.wasClean?s._websocket_onclose(t.CONNECTION_CLOSED,"WS-"+e.code+": "+e.reason):s._websocket_onclose(t.CONNECTION_LOST):s._websocket_onclose(t.CONNECTION_UNREACHABLE)),s._websocket_connected=!1,s._wsuri=null,s._websocket_onopen=null,s._websocket_onclose=null,s._websocket=null},s.log=function(){s._options&&"sessionIdent"in s._options?console.group("WAMP Session '"+s._options.sessionIdent+"' ["+s._session_id+"]"):console.group("WAMP Session ["+s._session_id+"]");for(var e=0;e<arguments.length;++e)console.log(arguments[e]);console.groupEnd()}},t.Session.prototype._send=function(e){var n=this;if(!n._websocket_connected)throw"Autobahn not connected";var r;switch(!0){case window.Prototype&&typeof top.window.__prototype_deleted=="undefined":case typeof e.toJSON=="function":r=e.toJSON();break;default:r=JSON.stringify(e)}n._websocket.send(r),n._txcnt+=1,t._debugws&&(console.group("WS Send"),console.info(n._wsuri+"  ["+n._session_id+"]"),console.log(n._txcnt),console.log(r),console.groupEnd())},t.Session.prototype.close=function(){var e=this;e._websocket_connected&&e._websocket.close()},t.Session.prototype.sessionid=function(){var e=this;return e._session_id},t.Session.prototype.wsuri=function(){var e=this;return e._wsuri},t.Session.prototype.shrink=function(e,t){var n=this;return t===undefined&&(t=!0),n._prefixes.shrink(e,t)},t.Session.prototype.resolve=function(e,t){var n=this;return t===undefined&&(t=!0),n._prefixes.resolve(e,t)},t.Session.prototype.prefix=function(e,n){var r=this;r._prefixes.set(e,n);if(t._debugrpc||t._debugpubsub)console.group("WAMP Prefix"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(e),console.log(n),console.groupEnd();var i=[t._MESSAGE_TYPEID_PREFIX,e,n];r._send(i)},t.Session.prototype.call=function(){var e=this,n=new t.Deferred,r;for(;;){r=t._newidFast();if(!(r in e._calls))break}e._calls[r]=n;var i=e._prefixes.shrink(arguments[0],!0),s=[t._MESSAGE_TYPEID_CALL,r,i];for(var o=1;o<arguments.length;o+=1)s.push(arguments[o]);return e._send(s),t._debugrpc&&(n._ab_callobj=s,n._ab_tid=e._wsuri+"  ["+e._session_id+"]["+r+"]",console.time(n._ab_tid),console.info()),n.promise.then?n.promise:n},t.Session.prototype.subscribe=function(e,n){var r=this,i=r._prefixes.resolve(e,!0);if(!(i in r._subscriptions)){t._debugpubsub&&(console.group("WAMP Subscribe"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(e),console.log(n),console.groupEnd());var s=[t._MESSAGE_TYPEID_SUBSCRIBE,e];r._send(s),r._subscriptions[i]=[]}var o=r._subscriptions[i].indexOf(n);if(o!==-1)throw"callback "+n+" already subscribed for topic "+i;r._subscriptions[i].push(n)},t.Session.prototype.unsubscribe=function(e,n){var r=this,i=r._prefixes.resolve(e,!0);if(!(i in r._subscriptions))throw"not subscribed to topic "+i;var s;if(n!==undefined){var o=r._subscriptions[i].indexOf(n);if(o===-1)throw"no callback "+n+" subscribed on topic "+i;s=n,r._subscriptions[i].splice(o,1)}else s=r._subscriptions[i].slice(),r._subscriptions[i]=[];if(r._subscriptions[i].length===0){delete r._subscriptions[i],t._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(r._wsuri+"  ["+r._session_id+"]"),console.log(e),console.log(s),console.groupEnd());var u=[t._MESSAGE_TYPEID_UNSUBSCRIBE,e];r._send(u)}},t.Session.prototype.publish=function(){var e=this,n=arguments[0],r=arguments[1],i=null,s=null,o=null,u=null;if(arguments.length>3){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";s=arguments[2],o=arguments[3],u=[t._MESSAGE_TYPEID_PUBLISH,n,r,s,o]}else if(arguments.length>2)if(typeof arguments[2]=="boolean")i=arguments[2],u=[t._MESSAGE_TYPEID_PUBLISH,n,r,i];else{if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";s=arguments[2],u=[t._MESSAGE_TYPEID_PUBLISH,n,r,s]}else u=[t._MESSAGE_TYPEID_PUBLISH,n,r];t._debugpubsub&&(console.group("WAMP Publish"),console.info(e._wsuri+"  ["+e._session_id+"]"),console.log(n),console.log(r),i!==null?console.log(i):s!==null&&(console.log(s),o!==null&&console.log(o)),console.groupEnd()),e._send(u)},t.Session.prototype.authreq=function(e,t){return this.call("http://api.wamp.ws/procedure#authreq",e,t)},t.Session.prototype.authsign=function(e,t){return t||(t=""),CryptoJS.HmacSHA256(e,t).toString(CryptoJS.enc.Base64)},t.Session.prototype.auth=function(e){return this.call("http://api.wamp.ws/procedure#auth",e)},t._connect=function(e){var n=new t.Session(e.wsuri,function(){e.connects+=1,e.retryCount=0,e.onConnect(n)},function(n,r){var i=null;switch(n){case t.CONNECTION_CLOSED:e.onHangup(n,"Connection was closed properly ["+r+"]");break;case t.CONNECTION_UNSUPPORTED:e.onHangup(n,"Browser does not support WebSocket.");break;case t.CONNECTION_UNREACHABLE:e.retryCount+=1,e.connects===0?e.onHangup(n,"Connection could not be established."):e.retryCount<=e.options.maxRetries?(i=e.onHangup(t.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+e.options.retryDelay/1e3+" second(s) - attempt "+e.retryCount+" of "+e.options.maxRetries+".",{delay:e.options.retryDelay,retries:e.retryCount,maxretries:e.options.maxRetries}),i?(t._debugconnect&&console.log("Connection unreachable - retrying stopped by app"),e.onHangup(t.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(t._debugconnect&&console.log("Connection unreachable - retrying ("+e.retryCount+") .."),window.setTimeout(t._connect,e.options.retryDelay,e))):e.onHangup(t.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case t.CONNECTION_LOST:e.retryCount+=1,e.retryCount<=e.options.maxRetries?(i=e.onHangup(t.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled "+e.retryCount+"th reconnect to occur in "+e.options.retryDelay/1e3+" second(s).",{delay:e.options.retryDelay,retries:e.retryCount,maxretries:e.options.maxRetries}),i?(t._debugconnect&&console.log("Connection lost - retrying stopped by app"),e.onHangup(t.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):(t._debugconnect&&console.log("Connection lost - retrying ("+e.retryCount+") .."),window.setTimeout(t._connect,e.options.retryDelay,e))):e.onHangup(t.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect"}},e.options)},t.connect=function(e,n,r,i){var s={};s.wsuri=e,i?s.options=i:s.options={},s.options.retryDelay===undefined&&(s.options.retryDelay=5e3),s.options.maxRetries===undefined&&(s.options.maxRetries=10),s.options.skipSubprotocolCheck===undefined&&(s.options.skipSubprotocolCheck=!1),s.options.skipSubprotocolAnnounce===undefined&&(s.options.skipSubprotocolAnnounce=!1);if(!n)throw"onConnect handler required!";s.onConnect=n,r?s.onHangup=r:s.onHangup=function(e,n,r){t._debugconnect&&console.log(e,n,r)},s.connects=0,s.retryCount=0,t._connect(s)},t.launch=function(e,n,r){function i(e,n){return function(){var r=[n];for(var i=0;i<arguments.length;++i)r.push(arguments[i]);return t.Session.prototype.call.apply(e,r)}}function s(e,t){e.api={};for(var n=0;n<t.rpc.length;++n){var r=t.rpc[n].uri,s=r.split("#")[1],o=r.split("#")[0].split("/");o=o[o.length-1],o in e.api||(e.api[o]={}),e.api[o][s]=new i(e,r)}}t.connect(e.wsuri,function(r){!e.appkey||e.appkey===""?r.authreq().then(function(){r.auth().then(function(e){n?n(r):t._debugconnect&&r.log("Session opened.")},r.log)},r.log):r.authreq(e.appkey,e.appextra).then(function(i){var s=null;if(typeof e.appsecret=="function")s=e.appsecret(i);else{var o=t.deriveKey(e.appsecret,JSON.parse(i).authextra);s=r.authsign(i,o)}r.auth(s).then(function(e){n?n(r):t._debugconnect&&r.log("Session opened.")},r.log)},r.log)},function(e,n,i){r?r(e,n,i):t._debugconnect&&t.log("Session closed.",e,n,i)},e.sessionConfig)},t}),ab._UA_FIREFOX=new RegExp(".*Firefox/([0-9+]*).*"),ab._UA_CHROME=new RegExp(".*Chrome/([0-9+]*).*"),ab._UA_CHROMEFRAME=new RegExp(".*chromeframe/([0-9]*).*"),ab._UA_WEBKIT=new RegExp(".*AppleWebKit/([0-9+.]*)w*.*"),ab._UA_WEBOS=new RegExp(".*webOS/([0-9+.]*)w*.*"),ab._matchRegex=function(e,t){var n=t.exec(e);return n?n[1]:n},ab.lookupWsSupport=function(){var e=navigator.userAgent;if(e.indexOf("MSIE")>-1){if(e.indexOf("MSIE 10")>-1)return[!0,!0,!0];if(e.indexOf("chromeframe")>-1){var t=parseInt(ab._matchRegex(e,ab._UA_CHROMEFRAME));return t>=14?[!0,!1,!0]:[!1,!1,!1]}return e.indexOf("MSIE 8")>-1||e.indexOf("MSIE 9")>-1?[!0,!0,!0]:[!1,!1,!1]}if(e.indexOf("Firefox")>-1){var t=parseInt(ab._matchRegex(e,ab._UA_FIREFOX));return t?t>=7?[!0,!1,!0]:t>=3?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!0]}if(e.indexOf("Safari")>-1&&e.indexOf("Chrome")==-1){var t=ab._matchRegex(e,ab._UA_WEBKIT);if(t){if(e.indexOf("Windows")>-1&&t=="534+")return[!0,!1,!0];if(e.indexOf("Macintosh")>-1){t=t.replace("+","").split(".");if(parseInt(t[0])==535&&parseInt(t[1])>=24||parseInt(t[0])>535)return[!0,!1,!0]}return e.indexOf("webOS")>-1?(t=ab._matchRegex(e,ab._UA_WEBOS).split("."),parseInt(t[0])==2?[!1,!0,!0]:[!1,!1,!1]):[!0,!0,!0]}return[!1,!1,!1]}if(e.indexOf("Chrome")>-1){var t=parseInt(ab._matchRegex(e,ab._UA_CHROME));return t?t>=14?[!0,!1,!0]:t>=4?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!1]}if(e.indexOf("Android")>-1)return e.indexOf("Firefox")>-1?[!0,!1,!0]:e.indexOf("CrMo")>-1?[!0,!1,!0]:e.indexOf("Opera")>-1?[!1,!1,!0]:e.indexOf("CrMo")>-1?[!0,!0,!0]:[!1,!1,!1];return e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1||e.indexOf("iPod")>-1?[!1,!1,!0]:[!1,!1,!1]};