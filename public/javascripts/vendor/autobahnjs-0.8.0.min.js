window.define||(window.define=function(factory){try{delete window.define}catch(e){window.define=void 0}window.when=factory()},window.define.amd={}),function(console){console||(console=window.console={log:function(){},info:function(){},warn:function(){},error:function(){}}),Function.prototype.bind||(Function.prototype.bind=function(context){var fn=this,args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(context,Array.prototype.concat.apply(args,arguments))}}),"object"==typeof console.log&&(console.log=Function.prototype.call.bind(console.log,console),console.info=Function.prototype.call.bind(console.info,console),console.warn=Function.prototype.call.bind(console.warn,console),console.error=Function.prototype.call.bind(console.error,console)),"group"in console||(console.group=function(msg){console.info("\n--- "+msg+" ---\n")}),"groupEnd"in console||(console.groupEnd=function(){console.log("\n")}),"time"in console||function(){var trackedTimes={};console.time=function(msg){trackedTimes[msg]=(new Date).getTime()},console.timeEnd=function(msg){var end=(new Date).getTime(),time=msg in trackedTimes?end-trackedTimes[msg]:0;console.info(msg+": "+time+"ms")}}()}(window.console),function(define,global){"use strict";define(function(require){function when(promiseOrValue,onFulfilled,onRejected,onProgress){return cast(promiseOrValue).then(onFulfilled,onRejected,onProgress)}function cast(x){return x instanceof Promise?x:resolve(x)}function Promise(sendMessage,inspect){this._message=sendMessage,this.inspect=inspect}function resolve(value){return promise(function(resolve){resolve(value)})}function reject(promiseOrValue){return when(promiseOrValue,rejected)}function defer(){function makeDeferred(resolvePending,rejectPending,notifyPending){deferred.resolve=deferred.resolver.resolve=function(value){return resolved?resolve(value):(resolved=!0,resolvePending(value),pending)},deferred.reject=deferred.resolver.reject=function(reason){return resolved?resolve(rejected(reason)):(resolved=!0,rejectPending(reason),pending)},deferred.notify=deferred.resolver.notify=function(update){return notifyPending(update),update}}var deferred,pending,resolved;return deferred={promise:undef,resolve:undef,reject:undef,notify:undef,resolver:{resolve:undef,reject:undef,notify:undef}},deferred.promise=pending=promise(makeDeferred),deferred}function promise(resolver){return _promise(resolver,monitorApi.PromiseStatus&&monitorApi.PromiseStatus())}function _promise(resolver,status){function _message(type,args,resolve,notify){function deliver(p){p._message(type,args,resolve,notify)}consumers?consumers.push(deliver):enqueue(function(){deliver(value)})}function inspect(){return value?value.inspect():toPendingState()}function promiseResolve(val){if(consumers){var queue=consumers;consumers=undef,enqueue(function(){value=coerce(self,val),status&&updateStatus(value,status),runHandlers(queue,value)})}}function promiseReject(reason){promiseResolve(rejected(reason))}function promiseNotify(update){if(consumers){var queue=consumers;enqueue(function(){runHandlers(queue,progressed(update))})}}var self,value,consumers=[];self=new Promise(_message,inspect),self._status=status;try{resolver(promiseResolve,promiseReject,promiseNotify)}catch(e){promiseReject(e)}return self}function runHandlers(queue,value){for(var i=0;i<queue.length;i++)queue[i](value)}function fulfilled(value){return near(new NearFulfilledProxy(value),function(){return toFulfilledState(value)})}function rejected(reason){return near(new NearRejectedProxy(reason),function(){return toRejectedState(reason)})}function near(proxy,inspect){return new Promise(function(type,args,resolve){try{resolve(proxy[type].apply(proxy,args))}catch(e){resolve(rejected(e))}},inspect)}function progressed(update){return new Promise(function(type,args,_,notify){var onProgress=args[2];try{notify("function"==typeof onProgress?onProgress(update):update)}catch(e){notify(e)}})}function coerce(self,x){if(x===self)return rejected(new TypeError);if(x instanceof Promise)return x;try{var untrustedThen=x===Object(x)&&x.then;return"function"==typeof untrustedThen?assimilate(untrustedThen,x):fulfilled(x)}catch(e){return rejected(e)}}function assimilate(untrustedThen,x){return promise(function(resolve,reject){fcall(untrustedThen,x,resolve,reject)})}function NearFulfilledProxy(value){this.value=value}function NearRejectedProxy(reason){this.reason=reason}function updateStatus(value,status){function statusFulfilled(){status.fulfilled()}function statusRejected(r){status.rejected(r)}value.then(statusFulfilled,statusRejected)}function isPromiseLike(x){return x&&"function"==typeof x.then}function some(promisesOrValues,howMany,onFulfilled,onRejected,onProgress){return when(promisesOrValues,function(promisesOrValues){function resolveSome(resolve,reject,notify){function rejecter(reason){rejectOne(reason)}function fulfiller(val){fulfillOne(val)}var toResolve,toReject,values,reasons,fulfillOne,rejectOne,len,i;if(len=promisesOrValues.length>>>0,toResolve=Math.max(0,Math.min(howMany,len)),values=[],toReject=len-toResolve+1,reasons=[],toResolve)for(rejectOne=function(reason){reasons.push(reason),--toReject||(fulfillOne=rejectOne=identity,reject(reasons))},fulfillOne=function(val){values.push(val),--toResolve||(fulfillOne=rejectOne=identity,resolve(values))},i=0;len>i;++i)i in promisesOrValues&&when(promisesOrValues[i],fulfiller,rejecter,notify);else resolve(values)}return promise(resolveSome).then(onFulfilled,onRejected,onProgress)})}function any(promisesOrValues,onFulfilled,onRejected,onProgress){function unwrapSingleResult(val){return onFulfilled?onFulfilled(val[0]):val[0]}return some(promisesOrValues,1,unwrapSingleResult,onRejected,onProgress)}function all(promisesOrValues,onFulfilled,onRejected,onProgress){return _map(promisesOrValues,identity).then(onFulfilled,onRejected,onProgress)}function join(){return _map(arguments,identity)}function settle(array){return _map(array,toFulfilledState,toRejectedState)}function map(array,mapFunc){return _map(array,mapFunc)}function _map(array,mapFunc,fallback){return when(array,function(array){function resolveMap(resolve,reject,notify){function resolveOne(item,i){when(item,mapFunc,fallback).then(function(mapped){results[i]=mapped,--toResolve||resolve(results)},reject,notify)}var results,len,toResolve,i;if(toResolve=len=array.length>>>0,results=[],!toResolve)return resolve(results),void 0;for(i=0;len>i;i++)i in array?resolveOne(array[i],i):--toResolve}return _promise(resolveMap)})}function reduce(promise,reduceFunc){var args=fcall(slice,arguments,1);return when(promise,function(array){var total;return total=array.length,args[0]=function(current,val,i){return when(current,function(c){return when(val,function(value){return reduceFunc(c,value,i,total)})})},reduceArray.apply(array,args)})}function toFulfilledState(x){return{state:"fulfilled",value:x}}function toRejectedState(x){return{state:"rejected",reason:x}}function toPendingState(){return{state:"pending"}}function enqueue(task){1===handlerQueue.push(task)&&nextTick(drainQueue)}function drainQueue(){runHandlers(handlerQueue),handlerQueue=[]}function identity(x){return x}when.promise=promise,when.resolve=resolve,when.reject=reject,when.defer=defer,when.join=join,when.all=all,when.map=map,when.reduce=reduce,when.settle=settle,when.any=any,when.some=some,when.isPromise=isPromiseLike,when.isPromiseLike=isPromiseLike,Promise.prototype={then:function(){var args,sendMessage;return args=arguments,sendMessage=this._message,_promise(function(resolve,reject,notify){sendMessage("when",args,resolve,notify)},this._status&&this._status.observed())},otherwise:function(onRejected){return this.then(undef,onRejected)},ensure:function(onFulfilledOrRejected){function injectHandler(){return resolve(onFulfilledOrRejected())}return"function"==typeof onFulfilledOrRejected?this.then(injectHandler,injectHandler).yield(this):this},yield:function(value){return this.then(function(){return value})},tap:function(onFulfilledSideEffect){return this.then(onFulfilledSideEffect).yield(this)},spread:function(onFulfilled){return this.then(function(array){return all(array,function(array){return onFulfilled.apply(undef,array)})})},always:function(onFulfilledOrRejected,onProgress){return this.then(onFulfilledOrRejected,onFulfilledOrRejected,onProgress)}},NearFulfilledProxy.prototype.when=function(onResult){return"function"==typeof onResult?onResult(this.value):this.value},NearRejectedProxy.prototype.when=function(_,onError){if("function"==typeof onError)return onError(this.reason);throw this.reason};var reduceArray,slice,fcall,nextTick,handlerQueue,setTimeout,funcProto,call,arrayProto,monitorApi,cjsRequire,MutationObserver,undef;if(cjsRequire=require,handlerQueue=[],setTimeout=global.setTimeout,monitorApi="undefined"!=typeof console?console:when,"object"==typeof process&&process.nextTick)nextTick=process.nextTick;else if(MutationObserver=global.MutationObserver||global.WebKitMutationObserver)nextTick=function(document,MutationObserver,drainQueue){var el=document.createElement("div");return new MutationObserver(drainQueue).observe(el,{attributes:!0}),function(){el.setAttribute("x","x")}}(document,MutationObserver,drainQueue);else try{nextTick=cjsRequire("vertx").runOnLoop||cjsRequire("vertx").runOnContext}catch(ignore){nextTick=function(t){setTimeout(t,0)}}return funcProto=Function.prototype,call=funcProto.call,fcall=funcProto.bind?call.bind(call):function(f,context){return f.apply(context,slice.call(arguments,2))},arrayProto=[],slice=arrayProto.slice,reduceArray=arrayProto.reduce||function(reduceFunc){var arr,args,reduced,len,i;if(i=0,arr=Object(this),len=arr.length>>>0,args=arguments,args.length<=1)for(;;){if(i in arr){reduced=arr[i++];break}if(++i>=len)throw new TypeError}else reduced=args[1];for(;len>i;++i)i in arr&&(reduced=reduceFunc(reduced,arr[i],i,arr));return reduced},when})}("function"==typeof define&&define.amd?define:function(factory){module.exports=factory(require)},this);var CryptoJS=CryptoJS||function(Math,undefined){var C={},C_lib=C.lib={},Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;return overrides&&subtype.mixIn(overrides),subtype.hasOwnProperty("init")||(subtype.init=function(){subtype.$super.init.apply(this,arguments)}),subtype.init.prototype=subtype,subtype.$super=this,subtype},create:function(){var instance=this.extend();return instance.init.apply(instance,arguments),instance},init:function(){},mixIn:function(properties){for(var propertyName in properties)properties.hasOwnProperty(propertyName)&&(this[propertyName]=properties[propertyName]);properties.hasOwnProperty("toString")&&(this.toString=properties.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[],this.sigBytes=sigBytes!=undefined?sigBytes:4*words.length},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words,thatWords=wordArray.words,thisSigBytes=this.sigBytes,thatSigBytes=wordArray.sigBytes;if(this.clamp(),thisSigBytes%4)for(var i=0;thatSigBytes>i;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}else if(thatWords.length>65535)for(var i=0;thatSigBytes>i;i+=4)thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2];else thisWords.push.apply(thisWords,thatWords);return this.sigBytes+=thatSigBytes,this},clamp:function(){var words=this.words,sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8,words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);return clone.words=this.words.slice(0),clone},random:function(nBytes){for(var words=[],i=0;nBytes>i;i+=4)words.push(4294967296*Math.random()|0);return new WordArray.init(words,nBytes)}}),C_enc=C.enc={},Hex=C_enc.Hex={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,hexChars=[],i=0;sigBytes>i;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16)),hexChars.push((15&bite).toString(16))}return hexChars.join("")},parse:function(hexStr){for(var hexStrLength=hexStr.length,words=[],i=0;hexStrLength>i;i+=2)words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4;return new WordArray.init(words,hexStrLength/2)}},Latin1=C_enc.Latin1={stringify:function(wordArray){for(var words=wordArray.words,sigBytes=wordArray.sigBytes,latin1Chars=[],i=0;sigBytes>i;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){for(var latin1StrLength=latin1Str.length,words=[],i=0;latin1StrLength>i;i++)words[i>>>2]|=(255&latin1Str.charCodeAt(i))<<24-i%4*8;return new WordArray.init(words,latin1StrLength)}},Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}},BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init,this._nDataBytes=0},_append:function(data){"string"==typeof data&&(data=Utf8.parse(data)),this._data.concat(data),this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data,dataWords=data.words,dataSigBytes=data.sigBytes,blockSize=this.blockSize,blockSizeBytes=4*blockSize,nBlocksReady=dataSigBytes/blockSizeBytes;nBlocksReady=doFlush?Math.ceil(nBlocksReady):Math.max((0|nBlocksReady)-this._minBufferSize,0);var nWordsReady=nBlocksReady*blockSize,nBytesReady=Math.min(4*nWordsReady,dataSigBytes);if(nWordsReady){for(var offset=0;nWordsReady>offset;offset+=blockSize)this._doProcessBlock(dataWords,offset);var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);return clone._data=this._data.clone(),clone},_minBufferSize:0}),C_algo=(C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg),this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this),this._doReset()},update:function(messageUpdate){return this._append(messageUpdate),this._process(),this},finalize:function(messageUpdate){messageUpdate&&this._append(messageUpdate);var hash=this._doFinalize();return hash},blockSize:16,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}}),C.algo={});return C}(Math);!function(){{var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,C_enc=C.enc;C_enc.Base64={stringify:function(wordArray){var words=wordArray.words,sigBytes=wordArray.sigBytes,map=this._map;wordArray.clamp();for(var base64Chars=[],i=0;sigBytes>i;i+=3)for(var byte1=words[i>>>2]>>>24-i%4*8&255,byte2=words[i+1>>>2]>>>24-(i+1)%4*8&255,byte3=words[i+2>>>2]>>>24-(i+2)%4*8&255,triplet=byte1<<16|byte2<<8|byte3,j=0;4>j&&sigBytes>i+.75*j;j++)base64Chars.push(map.charAt(triplet>>>6*(3-j)&63));var paddingChar=map.charAt(64);if(paddingChar)for(;base64Chars.length%4;)base64Chars.push(paddingChar);return base64Chars.join("")},parse:function(base64Str){var base64StrLength=base64Str.length,map=this._map,paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);-1!=paddingIndex&&(base64StrLength=paddingIndex)}for(var words=[],nBytes=0,i=0;base64StrLength>i;i++)if(i%4){var bits1=map.indexOf(base64Str.charAt(i-1))<<i%4*2,bits2=map.indexOf(base64Str.charAt(i))>>>6-i%4*2;words[nBytes>>>2]|=(bits1|bits2)<<24-nBytes%4*8,nBytes++}return WordArray.create(words,nBytes)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}}(),function(){{var C=CryptoJS,C_lib=C.lib,Base=C_lib.Base,C_enc=C.enc,Utf8=C_enc.Utf8,C_algo=C.algo;C_algo.HMAC=Base.extend({init:function(hasher,key){hasher=this._hasher=new hasher.init,"string"==typeof key&&(key=Utf8.parse(key));var hasherBlockSize=hasher.blockSize,hasherBlockSizeBytes=4*hasherBlockSize;key.sigBytes>hasherBlockSizeBytes&&(key=hasher.finalize(key)),key.clamp();for(var oKey=this._oKey=key.clone(),iKey=this._iKey=key.clone(),oKeyWords=oKey.words,iKeyWords=iKey.words,i=0;hasherBlockSize>i;i++)oKeyWords[i]^=1549556828,iKeyWords[i]^=909522486;oKey.sigBytes=iKey.sigBytes=hasherBlockSizeBytes,this.reset()},reset:function(){var hasher=this._hasher;hasher.reset(),hasher.update(this._iKey)},update:function(messageUpdate){return this._hasher.update(messageUpdate),this},finalize:function(messageUpdate){var hasher=this._hasher,innerHash=hasher.finalize(messageUpdate);hasher.reset();var hmac=hasher.finalize(this._oKey.clone().concat(innerHash));return hmac}})}}(),function(Math){var C=CryptoJS,C_lib=C.lib,WordArray=C_lib.WordArray,Hasher=C_lib.Hasher,C_algo=C.algo,H=[],K=[];!function(){function isPrime(n){for(var sqrtN=Math.sqrt(n),factor=2;sqrtN>=factor;factor++)if(!(n%factor))return!1;return!0}function getFractionalBits(n){return 4294967296*(n-(0|n))|0}for(var n=2,nPrime=0;64>nPrime;)isPrime(n)&&(8>nPrime&&(H[nPrime]=getFractionalBits(Math.pow(n,.5))),K[nPrime]=getFractionalBits(Math.pow(n,1/3)),nPrime++),n++}();var W=[],SHA256=C_algo.SHA256=Hasher.extend({_doReset:function(){this._hash=new WordArray.init(H.slice(0))},_doProcessBlock:function(M,offset){for(var H=this._hash.words,a=H[0],b=H[1],c=H[2],d=H[3],e=H[4],f=H[5],g=H[6],h=H[7],i=0;64>i;i++){if(16>i)W[i]=0|M[offset+i];else{var gamma0x=W[i-15],gamma0=(gamma0x<<25|gamma0x>>>7)^(gamma0x<<14|gamma0x>>>18)^gamma0x>>>3,gamma1x=W[i-2],gamma1=(gamma1x<<15|gamma1x>>>17)^(gamma1x<<13|gamma1x>>>19)^gamma1x>>>10;W[i]=gamma0+W[i-7]+gamma1+W[i-16]}var ch=e&f^~e&g,maj=a&b^a&c^b&c,sigma0=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),sigma1=(e<<26|e>>>6)^(e<<21|e>>>11)^(e<<7|e>>>25),t1=h+sigma1+ch+K[i]+W[i],t2=sigma0+maj;h=g,g=f,f=e,e=d+t1|0,d=c,c=b,b=a,a=t1+t2|0}H[0]=H[0]+a|0,H[1]=H[1]+b|0,H[2]=H[2]+c|0,H[3]=H[3]+d|0,H[4]=H[4]+e|0,H[5]=H[5]+f|0,H[6]=H[6]+g|0,H[7]=H[7]+h|0},_doFinalize:function(){var data=this._data,dataWords=data.words,nBitsTotal=8*this._nDataBytes,nBitsLeft=8*data.sigBytes;return dataWords[nBitsLeft>>>5]|=128<<24-nBitsLeft%32,dataWords[(nBitsLeft+64>>>9<<4)+14]=Math.floor(nBitsTotal/4294967296),dataWords[(nBitsLeft+64>>>9<<4)+15]=nBitsTotal,data.sigBytes=4*dataWords.length,this._process(),this._hash},clone:function(){var clone=Hasher.clone.call(this);return clone._hash=this._hash.clone(),clone}});C.SHA256=Hasher._createHelper(SHA256),C.HmacSHA256=Hasher._createHmacHelper(SHA256)}(Math),function(){var C=CryptoJS,C_lib=C.lib,Base=C_lib.Base,WordArray=C_lib.WordArray,C_algo=C.algo,SHA1=C_algo.SHA1,HMAC=C_algo.HMAC,PBKDF2=C_algo.PBKDF2=Base.extend({cfg:Base.extend({keySize:4,hasher:SHA1,iterations:1}),init:function(cfg){this.cfg=this.cfg.extend(cfg)},compute:function(password,salt){for(var cfg=this.cfg,hmac=HMAC.create(cfg.hasher,password),derivedKey=WordArray.create(),blockIndex=WordArray.create([1]),derivedKeyWords=derivedKey.words,blockIndexWords=blockIndex.words,keySize=cfg.keySize,iterations=cfg.iterations;derivedKeyWords.length<keySize;){var block=hmac.update(salt).finalize(blockIndex);hmac.reset();for(var blockWords=block.words,blockWordsLength=blockWords.length,intermediate=block,i=1;iterations>i;i++){intermediate=hmac.finalize(intermediate),hmac.reset();for(var intermediateWords=intermediate.words,j=0;blockWordsLength>j;j++)blockWords[j]^=intermediateWords[j]}derivedKey.concat(block),blockIndexWords[0]++}return derivedKey.sigBytes=4*keySize,derivedKey}});C.PBKDF2=function(password,salt,cfg){return PBKDF2.create(cfg).compute(password,salt)}}();var AUTOBAHNJS_VERSION="?.?.?";!function(root,factory){"function"==typeof define&&define.amd?define(["when"],function(when){return root.ab=factory(when)}):"undefined"!=typeof exports?"undefined"!=typeof module&&module.exports&&(exports=module.exports=factory(root.when)):root.ab=factory(root.when)}(this,function(when){"use strict";var ab={};return ab._version=AUTOBAHNJS_VERSION,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){if(null===this)throw new TypeError;var t=new Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&1/0!==n&&n!==-1/0&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);len>k;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(callback,thisArg){var T,k;if(null===this)throw new TypeError(" this is null or not defined");var O=new Object(this),len=O.length>>>0;if("[object Function]"!=={}.toString.call(callback))throw new TypeError(callback+" is not a function");for(thisArg&&(T=thisArg),k=0;len>k;){var kValue;k in O&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}})}(),ab._sliceUserAgent=function(str,delim,delim2){var ver=[],ua=navigator.userAgent,i=ua.indexOf(str),j=ua.indexOf(delim,i);0>j&&(j=ua.length);for(var agent=ua.slice(i,j).split(delim2),v=agent[1].split("."),k=0;k<v.length;++k)ver.push(parseInt(v[k],10));return{name:agent[0],version:ver}},ab.getBrowser=function(){var ua=navigator.userAgent;return ua.indexOf("Chrome")>-1?ab._sliceUserAgent("Chrome"," ","/"):ua.indexOf("Safari")>-1?ab._sliceUserAgent("Safari"," ","/"):ua.indexOf("Firefox")>-1?ab._sliceUserAgent("Firefox"," ","/"):ua.indexOf("MSIE")>-1?ab._sliceUserAgent("MSIE",";"," "):null},ab.getServerUrl=function(wsPath,fallbackUrl){if("file:"===window.location.protocol)return fallbackUrl?fallbackUrl:"ws://127.0.0.1/ws";var scheme="https:"===window.location.protocol?"wss://":"ws://",port=""!==window.location.port?":"+window.location.port:"",path=wsPath?wsPath:"ws";return scheme+window.location.hostname+port+"/"+path},ab.browserNotSupportedMessage="Browser does not support WebSockets (RFC6455)",ab.deriveKey=function(secret,extra){if(extra&&extra.salt){var salt=extra.salt,keylen=extra.keylen||32,iterations=extra.iterations||1e4,key=CryptoJS.PBKDF2(secret,salt,{keySize:keylen/4,iterations:iterations,hasher:CryptoJS.algo.SHA256});return key.toString(CryptoJS.enc.Base64)}return secret},ab._idchars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ab._idlen=16,ab._subprotocol="wamp",ab._newid=function(){for(var id="",i=0;i<ab._idlen;i+=1)id+=ab._idchars.charAt(Math.floor(Math.random()*ab._idchars.length));return id},ab._newidFast=function(){return Math.random().toString(36)},ab.log=function(){if(arguments.length>1){console.group("Log Item");for(var i=0;i<arguments.length;i+=1)console.log(arguments[i]);console.groupEnd()}else console.log(arguments[0])},ab._debugrpc=!1,ab._debugpubsub=!1,ab._debugws=!1,ab._debugconnect=!1,ab.debug=function(debugWamp,debugWs,debugConnect){if(!("console"in window))throw"browser does not support console object";ab._debugrpc=debugWamp,ab._debugpubsub=debugWamp,ab._debugws=debugWs,ab._debugconnect=debugConnect},ab.version=function(){return ab._version},ab.PrefixMap=function(){var self=this;self._index={},self._rindex={}},ab.PrefixMap.prototype.get=function(prefix){var self=this;return self._index[prefix]},ab.PrefixMap.prototype.set=function(prefix,uri){var self=this;self._index[prefix]=uri,self._rindex[uri]=prefix},ab.PrefixMap.prototype.setDefault=function(uri){var self=this;self._index[""]=uri,self._rindex[uri]=""},ab.PrefixMap.prototype.remove=function(prefix){var self=this,uri=self._index[prefix];uri&&(delete self._index[prefix],delete self._rindex[uri])},ab.PrefixMap.prototype.resolve=function(curie,pass){var self=this,i=curie.indexOf(":");if(i>=0){var prefix=curie.substring(0,i);if(self._index[prefix])return self._index[prefix]+curie.substring(i+1)}return pass===!0?curie:null},ab.PrefixMap.prototype.shrink=function(uri,pass){for(var self=this,i=uri.length;i>0;i-=1){var u=uri.substring(0,i),p=self._rindex[u];if(p)return p+":"+uri.substring(i)}return pass===!0?uri:null},ab._MESSAGE_TYPEID_WELCOME=0,ab._MESSAGE_TYPEID_PREFIX=1,ab._MESSAGE_TYPEID_CALL=2,ab._MESSAGE_TYPEID_CALL_RESULT=3,ab._MESSAGE_TYPEID_CALL_ERROR=4,ab._MESSAGE_TYPEID_SUBSCRIBE=5,ab._MESSAGE_TYPEID_UNSUBSCRIBE=6,ab._MESSAGE_TYPEID_PUBLISH=7,ab._MESSAGE_TYPEID_EVENT=8,ab.CONNECTION_CLOSED=0,ab.CONNECTION_LOST=1,ab.CONNECTION_RETRIES_EXCEEDED=2,ab.CONNECTION_UNREACHABLE=3,ab.CONNECTION_UNSUPPORTED=4,ab.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT=5,ab.CONNECTION_LOST_SCHEDULED_RECONNECT=6,ab.Deferred=when.defer,ab._construct=function(url,protocols){return"WebSocket"in window?protocols?new WebSocket(url,protocols):new WebSocket(url):"MozWebSocket"in window?protocols?new MozWebSocket(url,protocols):new MozWebSocket(url):null},ab.Session=function(wsuri,onopen,onclose,options){var self=this;if(self._wsuri=wsuri,self._options=options,self._websocket_onopen=onopen,self._websocket_onclose=onclose,self._websocket=null,self._websocket_connected=!1,self._session_id=null,self._wamp_version=null,self._server=null,self._calls={},self._subscriptions={},self._prefixes=new ab.PrefixMap,self._txcnt=0,self._rxcnt=0,self._websocket=self._options&&self._options.skipSubprotocolAnnounce?ab._construct(self._wsuri):ab._construct(self._wsuri,[ab._subprotocol]),!self._websocket){if(void 0!==onclose)return onclose(ab.CONNECTION_UNSUPPORTED),void 0;throw ab.browserNotSupportedMessage}self._websocket.onmessage=function(e){ab._debugws&&(self._rxcnt+=1,console.group("WS Receive"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(self._rxcnt),console.log(e.data),console.groupEnd());var o=JSON.parse(e.data);if(o[1]in self._calls){if(o[0]===ab._MESSAGE_TYPEID_CALL_RESULT){var dr=self._calls[o[1]],r=o[2];if(ab._debugrpc&&void 0!==dr._ab_callobj){console.group("WAMP Call",dr._ab_callobj[2]),console.timeEnd(dr._ab_tid),console.group("Arguments");for(var i=3;i<dr._ab_callobj.length;i+=1){var arg=dr._ab_callobj[i];if(void 0===arg)break;console.log(arg)}console.groupEnd(),console.group("Result"),console.log(r),console.groupEnd(),console.groupEnd()}dr.resolve(r)}else if(o[0]===ab._MESSAGE_TYPEID_CALL_ERROR){var de=self._calls[o[1]],uri_=o[2],desc_=o[3],detail_=o[4];if(ab._debugrpc&&void 0!==de._ab_callobj){console.group("WAMP Call",de._ab_callobj[2]),console.timeEnd(de._ab_tid),console.group("Arguments");for(var j=3;j<de._ab_callobj.length;j+=1){var arg2=de._ab_callobj[j];if(void 0===arg2)break;console.log(arg2)}console.groupEnd(),console.group("Error"),console.log(uri_),console.log(desc_),void 0!==detail_&&console.log(detail_),console.groupEnd(),console.groupEnd()}void 0!==detail_?de.reject({uri:uri_,desc:desc_,detail:detail_}):de.reject({uri:uri_,desc:desc_})}delete self._calls[o[1]]}else if(o[0]===ab._MESSAGE_TYPEID_EVENT){var subid=self._prefixes.resolve(o[1],!0);if(subid in self._subscriptions){var uri2=o[1],val=o[2];ab._debugpubsub&&(console.group("WAMP Event"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(uri2),console.log(val),console.groupEnd()),self._subscriptions[subid].forEach(function(callback){callback(uri2,val)})}}else if(o[0]===ab._MESSAGE_TYPEID_WELCOME){if(null!==self._session_id)throw"protocol error (welcome message received more than once)";self._session_id=o[1],self._wamp_version=o[2],self._server=o[3],(ab._debugrpc||ab._debugpubsub)&&(console.group("WAMP Welcome"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(self._wamp_version),console.log(self._server),console.groupEnd()),null!==self._websocket_onopen&&self._websocket_onopen()}},self._websocket.onopen=function(){if(self._websocket.protocol!==ab._subprotocol)if("undefined"==typeof self._websocket.protocol)ab._debugws&&(console.group("WS Warning"),console.info(self._wsuri),console.log("WebSocket object has no protocol attribute: WAMP subprotocol check skipped!"),console.groupEnd());else{if(!self._options||!self._options.skipSubprotocolCheck)throw self._websocket.close(1e3,"server does not speak WAMP"),"server does not speak WAMP (but '"+self._websocket.protocol+"' !)";ab._debugws&&(console.group("WS Warning"),console.info(self._wsuri),console.log("Server does not speak WAMP, but subprotocol check disabled by option!"),console.log(self._websocket.protocol),console.groupEnd())}ab._debugws&&(console.group("WAMP Connect"),console.info(self._wsuri),console.log(self._websocket.protocol),console.groupEnd()),self._websocket_connected=!0},self._websocket.onerror=function(){},self._websocket.onclose=function(e){ab._debugws&&(self._websocket_connected?console.log("Autobahn connection to "+self._wsuri+" lost (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+")."):console.log("Autobahn could not connect to "+self._wsuri+" (code "+e.code+", reason '"+e.reason+"', wasClean "+e.wasClean+").")),void 0!==self._websocket_onclose&&(self._websocket_connected?e.wasClean?self._websocket_onclose(ab.CONNECTION_CLOSED,"WS-"+e.code+": "+e.reason):self._websocket_onclose(ab.CONNECTION_LOST):self._websocket_onclose(ab.CONNECTION_UNREACHABLE)),self._websocket_connected=!1,self._wsuri=null,self._websocket_onopen=null,self._websocket_onclose=null,self._websocket=null},self.log=function(){self._options&&"sessionIdent"in self._options?console.group("WAMP Session '"+self._options.sessionIdent+"' ["+self._session_id+"]"):console.group("WAMP Session ["+self._session_id+"]");for(var i=0;i<arguments.length;++i)console.log(arguments[i]);console.groupEnd()}},ab.Session.prototype._send=function(msg){var self=this;if(!self._websocket_connected)throw"Autobahn not connected";var rmsg;switch(!0){case window.Prototype&&"undefined"==typeof top.window.__prototype_deleted:case"function"==typeof msg.toJSON:rmsg=msg.toJSON();break;default:rmsg=JSON.stringify(msg)}self._websocket.send(rmsg),self._txcnt+=1,ab._debugws&&(console.group("WS Send"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(self._txcnt),console.log(rmsg),console.groupEnd())},ab.Session.prototype.close=function(){var self=this;self._websocket_connected&&self._websocket.close()},ab.Session.prototype.sessionid=function(){var self=this;return self._session_id},ab.Session.prototype.wsuri=function(){var self=this;return self._wsuri},ab.Session.prototype.shrink=function(uri,pass){var self=this;return void 0===pass&&(pass=!0),self._prefixes.shrink(uri,pass)},ab.Session.prototype.resolve=function(curie,pass){var self=this;return void 0===pass&&(pass=!0),self._prefixes.resolve(curie,pass)},ab.Session.prototype.prefix=function(prefix,uri){var self=this;self._prefixes.set(prefix,uri),(ab._debugrpc||ab._debugpubsub)&&(console.group("WAMP Prefix"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(prefix),console.log(uri),console.groupEnd());var msg=[ab._MESSAGE_TYPEID_PREFIX,prefix,uri];self._send(msg)},ab.Session.prototype.call=function(){for(var callid,self=this,d=new ab.Deferred;;)if(callid=ab._newidFast(),!(callid in self._calls))break;self._calls[callid]=d;for(var procuri=self._prefixes.shrink(arguments[0],!0),obj=[ab._MESSAGE_TYPEID_CALL,callid,procuri],i=1;i<arguments.length;i+=1)obj.push(arguments[i]);return self._send(obj),ab._debugrpc&&(d._ab_callobj=obj,d._ab_tid=self._wsuri+"  ["+self._session_id+"]["+callid+"]",console.time(d._ab_tid),console.info()),d.promise.then?d.promise:d},ab.Session.prototype.subscribe=function(topicuri,callback){var self=this,rtopicuri=self._prefixes.resolve(topicuri,!0);if(!(rtopicuri in self._subscriptions)){ab._debugpubsub&&(console.group("WAMP Subscribe"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(topicuri),console.log(callback),console.groupEnd());var msg=[ab._MESSAGE_TYPEID_SUBSCRIBE,topicuri];self._send(msg),self._subscriptions[rtopicuri]=[]}var i=self._subscriptions[rtopicuri].indexOf(callback);if(-1!==i)throw"callback "+callback+" already subscribed for topic "+rtopicuri;self._subscriptions[rtopicuri].push(callback)},ab.Session.prototype.unsubscribe=function(topicuri,callback){var self=this,rtopicuri=self._prefixes.resolve(topicuri,!0);
if(!(rtopicuri in self._subscriptions))throw"not subscribed to topic "+rtopicuri;var removed;if(void 0!==callback){var idx=self._subscriptions[rtopicuri].indexOf(callback);if(-1===idx)throw"no callback "+callback+" subscribed on topic "+rtopicuri;removed=callback,self._subscriptions[rtopicuri].splice(idx,1)}else removed=self._subscriptions[rtopicuri].slice(),self._subscriptions[rtopicuri]=[];if(0===self._subscriptions[rtopicuri].length){delete self._subscriptions[rtopicuri],ab._debugpubsub&&(console.group("WAMP Unsubscribe"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(topicuri),console.log(removed),console.groupEnd());var msg=[ab._MESSAGE_TYPEID_UNSUBSCRIBE,topicuri];self._send(msg)}},ab.Session.prototype.publish=function(){var self=this,topicuri=arguments[0],event=arguments[1],excludeMe=null,exclude=null,eligible=null,msg=null;if(arguments.length>3){if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";if(!(arguments[3]instanceof Array))throw"invalid argument type(s)";exclude=arguments[2],eligible=arguments[3],msg=[ab._MESSAGE_TYPEID_PUBLISH,topicuri,event,exclude,eligible]}else if(arguments.length>2)if("boolean"==typeof arguments[2])excludeMe=arguments[2],msg=[ab._MESSAGE_TYPEID_PUBLISH,topicuri,event,excludeMe];else{if(!(arguments[2]instanceof Array))throw"invalid argument type(s)";exclude=arguments[2],msg=[ab._MESSAGE_TYPEID_PUBLISH,topicuri,event,exclude]}else msg=[ab._MESSAGE_TYPEID_PUBLISH,topicuri,event];ab._debugpubsub&&(console.group("WAMP Publish"),console.info(self._wsuri+"  ["+self._session_id+"]"),console.log(topicuri),console.log(event),null!==excludeMe?console.log(excludeMe):null!==exclude&&(console.log(exclude),null!==eligible&&console.log(eligible)),console.groupEnd()),self._send(msg)},ab.Session.prototype.authreq=function(appkey,extra){return this.call("http://api.wamp.ws/procedure#authreq",appkey,extra)},ab.Session.prototype.authsign=function(challenge,secret){return secret||(secret=""),CryptoJS.HmacSHA256(challenge,secret).toString(CryptoJS.enc.Base64)},ab.Session.prototype.auth=function(signature){return this.call("http://api.wamp.ws/procedure#auth",signature)},ab._connect=function(peer){var sess=new ab.Session(peer.wsuri,function(){peer.connects+=1,peer.retryCount=0,peer.onConnect(sess)},function(code,reason){var stop=null;switch(code){case ab.CONNECTION_CLOSED:peer.onHangup(code,"Connection was closed properly ["+reason+"]");break;case ab.CONNECTION_UNSUPPORTED:peer.onHangup(code,"Browser does not support WebSocket.");break;case ab.CONNECTION_UNREACHABLE:peer.retryCount+=1,0===peer.connects?peer.onHangup(code,"Connection could not be established."):peer.retryCount<=peer.options.maxRetries?(stop=peer.onHangup(ab.CONNECTION_UNREACHABLE_SCHEDULED_RECONNECT,"Connection unreachable - scheduled reconnect to occur in "+peer.options.retryDelay/1e3+" second(s) - attempt "+peer.retryCount+" of "+peer.options.maxRetries+".",{delay:peer.options.retryDelay,retries:peer.retryCount,maxretries:peer.options.maxRetries}),stop?(ab._debugconnect&&console.log("Connection unreachable - retrying stopped by app"),peer.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.")):(ab._debugconnect&&console.log("Connection unreachable - retrying ("+peer.retryCount+") .."),window.setTimeout(ab._connect,peer.options.retryDelay,peer))):peer.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Number of connection retries exceeded.");break;case ab.CONNECTION_LOST:peer.retryCount+=1,peer.retryCount<=peer.options.maxRetries?(stop=peer.onHangup(ab.CONNECTION_LOST_SCHEDULED_RECONNECT,"Connection lost - scheduled "+peer.retryCount+"th reconnect to occur in "+peer.options.retryDelay/1e3+" second(s).",{delay:peer.options.retryDelay,retries:peer.retryCount,maxretries:peer.options.maxRetries}),stop?(ab._debugconnect&&console.log("Connection lost - retrying stopped by app"),peer.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Connection lost.")):(ab._debugconnect&&console.log("Connection lost - retrying ("+peer.retryCount+") .."),window.setTimeout(ab._connect,peer.options.retryDelay,peer))):peer.onHangup(ab.CONNECTION_RETRIES_EXCEEDED,"Connection lost.");break;default:throw"unhandled close code in ab._connect"}},peer.options)},ab.connect=function(wsuri,onconnect,onhangup,options){var peer={};if(peer.wsuri=wsuri,peer.options=options?options:{},void 0===peer.options.retryDelay&&(peer.options.retryDelay=5e3),void 0===peer.options.maxRetries&&(peer.options.maxRetries=10),void 0===peer.options.skipSubprotocolCheck&&(peer.options.skipSubprotocolCheck=!1),void 0===peer.options.skipSubprotocolAnnounce&&(peer.options.skipSubprotocolAnnounce=!1),!onconnect)throw"onConnect handler required!";peer.onConnect=onconnect,peer.onHangup=onhangup?onhangup:function(code,reason,detail){ab._debugconnect&&console.log(code,reason,detail)},peer.connects=0,peer.retryCount=0,ab._connect(peer)},ab.launch=function(appConfig,onOpen,onClose){ab.connect(appConfig.wsuri,function(session){appConfig.appkey&&""!==appConfig.appkey?session.authreq(appConfig.appkey,appConfig.appextra).then(function(challenge){var signature=null;if("function"==typeof appConfig.appsecret)signature=appConfig.appsecret(challenge);else{var secret=ab.deriveKey(appConfig.appsecret,JSON.parse(challenge).authextra);signature=session.authsign(challenge,secret)}session.auth(signature).then(function(){onOpen?onOpen(session):ab._debugconnect&&session.log("Session opened.")},session.log)},session.log):session.authreq().then(function(){session.auth().then(function(){onOpen?onOpen(session):ab._debugconnect&&session.log("Session opened.")},session.log)},session.log)},function(code,reason,detail){onClose?onClose(code,reason,detail):ab._debugconnect&&ab.log("Session closed.",code,reason,detail)},appConfig.sessionConfig)},ab}),ab._UA_FIREFOX=new RegExp(".*Firefox/([0-9+]*).*"),ab._UA_CHROME=new RegExp(".*Chrome/([0-9+]*).*"),ab._UA_CHROMEFRAME=new RegExp(".*chromeframe/([0-9]*).*"),ab._UA_WEBKIT=new RegExp(".*AppleWebKit/([0-9+.]*)w*.*"),ab._UA_WEBOS=new RegExp(".*webOS/([0-9+.]*)w*.*"),ab._matchRegex=function(s,r){var m=r.exec(s);return m?m[1]:m},ab.lookupWsSupport=function(){var ua=navigator.userAgent;if(ua.indexOf("MSIE")>-1){if(ua.indexOf("MSIE 10")>-1)return[!0,!0,!0];if(ua.indexOf("chromeframe")>-1){var v=parseInt(ab._matchRegex(ua,ab._UA_CHROMEFRAME));return v>=14?[!0,!1,!0]:[!1,!1,!1]}return ua.indexOf("MSIE 8")>-1||ua.indexOf("MSIE 9")>-1?[!0,!0,!0]:[!1,!1,!1]}if(ua.indexOf("Firefox")>-1){var v=parseInt(ab._matchRegex(ua,ab._UA_FIREFOX));return v?v>=7?[!0,!1,!0]:v>=3?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!0]}if(ua.indexOf("Safari")>-1&&-1==ua.indexOf("Chrome")){var v=ab._matchRegex(ua,ab._UA_WEBKIT);return v?ua.indexOf("Windows")>-1&&"534+"==v?[!0,!1,!0]:ua.indexOf("Macintosh")>-1&&(v=v.replace("+","").split("."),535==parseInt(v[0])&&parseInt(v[1])>=24||parseInt(v[0])>535)?[!0,!1,!0]:ua.indexOf("webOS")>-1?(v=ab._matchRegex(ua,ab._UA_WEBOS).split("."),2==parseInt(v[0])?[!1,!0,!0]:[!1,!1,!1]):[!0,!0,!0]:[!1,!1,!1]}if(ua.indexOf("Chrome")>-1){var v=parseInt(ab._matchRegex(ua,ab._UA_CHROME));return v?v>=14?[!0,!1,!0]:v>=4?[!0,!0,!0]:[!1,!1,!0]:[!1,!1,!1]}return ua.indexOf("Android")>-1?ua.indexOf("Firefox")>-1?[!0,!1,!0]:ua.indexOf("CrMo")>-1?[!0,!1,!0]:ua.indexOf("Opera")>-1?[!1,!1,!0]:ua.indexOf("CrMo")>-1?[!0,!0,!0]:[!1,!1,!1]:ua.indexOf("iPhone")>-1||ua.indexOf("iPad")>-1||ua.indexOf("iPod")>-1?[!1,!1,!0]:[!1,!1,!1]};