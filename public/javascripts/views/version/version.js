define(["backbone","ejs","views/helpers/modal"],function(e,t,n){var r=e.View.extend({events:{'click [data-action="push"]':"push",'click [data-action="pull"]':"pull"},className:"version",template:new t({url:" javascripts/templates/version/version.ejs?"+(new Date).getTime()}),initialize:function(e){$("#content").before(this.$el),this.$el.hide()},render:function(e,t){return typeof t=="object"?t=_.extend(t,{action:e}):t={action:e},this.$el.show(),this.$el.html(this.template.render(t)),this},change:function(e){switch(e.status){case"behind":this.showPull(e.amount);break;case"ahead":this.showPush();break;case"nothing":this.hide()}},hide:function(){this.$el.hide()},showPull:function(e){this.render("pull",{amount:e})},showPush:function(){this.render("push")},push:function(){(new i({version:this})).render()},pull:function(){this.showLoader("Downloading updates"),$.ajax({url:fluidBranch+"/pull"}).complete(function(){location.reload()})},showLoader:function(e){this.render("loading",{msg:e})}}),i=e.View.extend($.extend({},n,{events:$.extend({"keypress :input":"submit"},n.events),template:new t({url:" javascripts/templates/version/commit-modal.ejs?"+(new Date).getTime()}),initialize:function(e){this.version=e.version},submit:function(e){e.charCode==13&&$(e.target).val()!=""&&(this.version.showLoader("Publishing updates"),$.ajax({url:fluidBranch+"/commit+push",type:"POST",data:{msg:$(e.target).val()}}),this.close())}}));return r});